
@{
    ViewBag.Title = "AppointmentDetails";
}
<style>
    .loader {
        position: fixed;
        top: 50%;
        left: 50%;
        height: 150px;
        width: 150px;
        overflow: hidden;
        z-index: 9999;
        opacity: 1;
        transition: opacity 0.5s;
        display: flex;
        justify-content: center;
        align-items: center;
        border: 16px solid #f3f3f3;
        border-radius: 50%;
        border-top: 16px solid #1c6279;
        -webkit-animation: spin 2s linear infinite; /* Safari */
        animation: spin 2s linear infinite;
    }

    /* Safari */
    @@-webkit-keyframes spin {
        0% {
            -webkit-transform: rotate(0deg);
        }

        100% {
            -webkit-transform: rotate(360deg);
        }
    }

    @@keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }
</style>


<div class="loader"></div>

<div class="modal fade" id="myModal4" role="dialog">
    <div class="modal-dialog modal-lg">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" style="font-style: italic; font-weight:600;font-family:'Times New Roman'">Documents Files</h5>

            </div>
            <div class="modal-body" id="Initial_Analysiz">


            </div>
            <div class="modal-footer">
                <button type="button" class="button" data-dismiss="modal">Close</button>
            </div>

        </div>

    </div>
</div>


<div class="modal fade" id="myModal5" role="dialog" data-backdrop="false">
    <div class="modal-dialog modal-lg">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" style="font-style: italic; font-weight:600;font-family:'Times New Roman'">Initial Assesment</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body mb-0 p-0">
                <div class="row">

                    <div class="col-md-12 p-5">

                        <div id="Initial_Analysiz1">


                        </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="button" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>






<div class="modal fade" id="myModal6" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="false"
     aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">

        <!--Content-->

        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" style="font-style: italic; font-weight:600;font-family:'Times New Roman'">Basic Info</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>


            <!--Body-->
            <div class="modal-body mb-0 p-0">


                <div class="row">
                    <div class="col-md-12 p-5">
                        <div id="Initial_Analysiz2">

                        </div>


                    </div><!-- ends col-6 -->


                </div>


            </div>

            <!--Footer-->
            <div class="modal-footer">
                <button type="button" class=" btn btn-danger" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
    <!--/.Content-->

</div>

<div id="tabs">
    <ul id="uls">
        <li><a href="#tabs-1">Follow ups</a></li>
        <li><a href="#tabs-2">Prescription</a></li>
        <li><a href="#tabs-3">Documents</a></li>
        <li>
            <button class="btn btn-secondary PateintBasicInformation">Basic Info</button>
        </li>
        <li>
            <button class="btn btn-secondary Initial_Analysiz">View Initial Analysis</button>


        </li>

    </ul>
    <div id="tabs-1">
        <button class="btn btn-success FollowupAnalysis ml-2 mb-3" data-toggle='modal' data-target='#modalFollowups'>Add Follow ups</button>


        <div class="modal fade" id="modalFollowups" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="false"
             aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">

                <!--Content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" style="font-style: italic; font-weight:600;font-family:'Times New Roman'">Follow ups</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <!--Body-->
                    <div class="modal-body mb-0 p-0">


                        <div class="row">
                            <div class="col-md-12 p-5">
                                <form>
                                    <fieldset>
                                        <div class="form-group">
                                            <input class="form-control" type="hidden" readonly="" name="username" id="PkID" value="" />


                                            <input class="form-control" type="hidden" readonly="" name="username" id="PateintID" value="" />

                                            <div class="form-group">
                                                <label for="CurrentMedication"><span class="req">* </span> Current Medication  </label>
                                                <input class="form-control jqte-test" type="text" name="CurrentMedication" id="CurrentMedication" value="" placeholder="Current Medication" />

                                            </div>
                                            <div class="form-group">
                                                <label for="ProgressiveNote"><span class="req">* </span> Progress  Note </label>
                                                <input class="form-control jqte-test" required type="email" name="email" id="ProgressiveNote" value="" placeholder="Progressive Note" />

                                            </div>




                                            <div class="form-group" style="display:none">
                                                <label for="Subjective"><span class="req">* </span> Subjective </label>
                                                <input required type="text" name="Subjective" value="" id="Subjective" class="form-control jqte-test " placeholder="Subjective" />
                                            </div>


                                            <div class="form-group">
                                                <label for="ObjectiveandMentalStateExamination"><span class="req">* </span> Objective and Mental State Examination </label>
                                                <input required type="text" name="ObjectiveandMentalStateExamination" value="" id="ObjectiveandMentalStateExamination" class="form-control jqte-test" placeholder="Objective and Mental State Examination" />
                                            </div>



                                            <div class="form-group">
                                                <label for="Assessment"><span class="req">* </span> Assessment  and Plan </label>
                                                <br />
                                                <textarea rows="4" cols="74" id="Assessment" class="jqte-test"></textarea>

                                            </div>


                                            <div class="form-group" style="display:none">
                                                <label for="CNIC"><span class="req">* </span> Plan </label>
                                                <br />
                                                <textarea rows="4" cols="74" id="Plan" class="jqte-test"></textarea>

                                            </div>





                                            <div class="form-group">

                                                <button type="button" class="btn btn-success" id="FollowupAnalysisbtn">Add</button>

                                                <div id="Editfollowps" style="display:none">
                                                    <input type="button" class="btn btn-success" id="EditFollowupAnalysisbtn" value="Update" />

                                                </div>

                                            </div>





                                        </div>





                                    </fieldset>
                                </form><!-- ends register form -->

                            </div><!-- ends col-6 -->


                        </div>


                    </div>

                    <!--Footer-->
                    <div class="modal-footer">
                        <button type="button" class=" btn btn-danger" data-dismiss="modal">Close</button>
                    </div>
                </div>

            </div>
            <!--/.Content-->




        </div>
        <section class="content">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                        </div>
                        <!-- /.card-header -->
                        <div class="card-body">
                            <div class="table-responsive">

                                <table id="Followtupstable" class="table table-bordered table-hover ">
                                    <thead>
                                        <tr>
                                            <th>Current Medication</th>

                                            <th>Progress Note</th>
                                            @*<th>Subjective </th>*@

                                            @*<th>ObjectiveandMentalStateExamination </th>*@



                                            <th>Date</th>

                                            <th>Actions</th>

                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Column -->
            <!-- ============================================================== -->
            <!-- End PAge Content -->
            <!-- ============================================================== -->
            <!-- ============================================================== -->
            <!-- Right sidebar -->
            <!-- ============================================================== -->
            <!-- .right-sidebar -->
            <!-- ============================================================== -->
            <!-- End Right sidebar -->
            <!-- ============================================================== -->
        </section>
    </div>
    <div id="tabs-2">

        <button class="btn btn-success  ml-2 mb-3" data-toggle='modal' data-target='#prescriptionModal' id="prescriptionModalbutton">Add Prescription </button>


        <div class="modal fade" id="prescriptinSuggestmodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
             aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">

                <!--Content-->
                <div class="modal-content">

                    <!--Body-->
                    <div class="modal-body mb-0 p-0">


                        <div class="row">
                            <div class="col-md-12 p-5">
                                <form id="SuggestprescriptionForm">
                                    <fieldset>
                                        <div class="form-group">


                                            <div class="form-group">
                                                <label for="ProgressiveNote"><span class="req">* Patient Name </span>  </label>

                                                <select id="SuggestPatient" class="form-control" name="Role" style="width:80%">
                                                    <option></option>
                                                </select>

                                            </div>
                                            <div class="form-group">
                                                <label for="ProgressiveNote"><span class="req">* From Date </span>  </label>

                                                <input type="date" id="SuggestFromDate" value="" />
                                            </div>

                                            <div class="form-group">
                                                <label for="ProgressiveNote"><span class="req">* To Date </span>  </label>

                                                <input type="date" id="SuggestToDate" value="" />
                                            </div>




                                            <div class="form-group">

                                                <button type="button" class="btn btn-success" id="SuggestprescriptionSavebtn">Save</button>

                                            </div>





                                        </div>





                                    </fieldset>
                                </form><!-- ends register form -->

                            </div><!-- ends col-6 -->


                        </div>


                    </div>

                    <!--Footer-->
                    <div class="modal-footer">
                        <button type="button" class=" btn btn-danger" data-dismiss="modal">Close</button>
                    </div>
                </div>

            </div>
            <!--/.Content-->




        </div>



        <div class="modal fade" id="prescriptionModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="false"
             aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">

                <!--Content-->
                <div class="modal-content">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>



                    <!--Body-->
                    <div class="modal-body mb-0 p-0">


                        <div class="row">
                            <div class="col-md-12 p-5">
                                <form id="prescriptionForm">
                                    <fieldset>
                                        <div class="form-group">
                                            <input class="form-control" type="hidden" readonly="" name="username" id="Presid" value="0" />


                                            <input class="form-control" type="hidden" readonly="" name="username" id="PateintIDPrec" value="" />




                                            <div class="form-group">
                                                <label for="Medication"><span class="req">* </span> Medication  </label>
                                                <input class="form-control jqte-test" type="text" name="Medication" id="Medication" value="" placeholder="Medication " />

                                            </div>


                                            <div class="form-group">
                                                <label for="Medication"><span class="req">* </span> Investigations  </label>
                                                <input class="form-control jqte-test" type="text" name="Investigations" id="Investigations" value="" placeholder="Investigations " />

                                            </div>
                                            <div class="form-group">
                                                <label for="Medication"><span class="req">* </span> Referral  </label>
                                                <input class="form-control jqte-test" type="text" name="Referral" id="Referral" value="" placeholder="Referral " />

                                            </div>

                                            <div class="form-group">
                                                <label for="Advice"><span class="req">* </span> Advice  </label>
                                                <input class="form-control jqte-test" type="text" name="Advice" id="Advice" value="" placeholder="Advice " />

                                            </div>



                                            <div class="form-group">
                                                <label for="Advice"><span class="req">* </span> Return to Clinic  </label>
                                                <input class="form-control" type="text" readonly="readonly"
                                                       name="Return_to_Clinic" id="Return_to_Clinic" />

                                            </div>



                                            <div class="form-group">

                                                <button type="button" class="btn btn-success" id="prescriptionSavebtn">Save</button>

                                            </div>





                                        </div>





                                    </fieldset>
                                </form><!-- ends register form -->

                            </div><!-- ends col-6 -->


                        </div>


                    </div>

                    <!--Footer-->
                    <div class="modal-footer">
                        <button type="button" class=" btn btn-danger" data-dismiss="modal">Close</button>
                    </div>
                </div>

            </div>
            <!--/.Content-->




        </div>

        <section class="content">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                        </div>
                        <!-- /.card-header -->
                        <div class="card-body">
                            <div class="table-responsive">

                                <table id="prescriptionTable" class="table table-bordered table-hover " style="width:100%">
                                    <thead>
                                        <tr>
                                            <th>Medication</th>

                                            <th>Return to Clinic</th>


                                            <th>Actions</th>

                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Column -->
            <!-- ============================================================== -->
            <!-- End PAge Content -->
            <!-- ============================================================== -->
            <!-- ============================================================== -->
            <!-- Right sidebar -->
            <!-- ============================================================== -->
            <!-- .right-sidebar -->
            <!-- ============================================================== -->
            <!-- End Right sidebar -->
            <!-- ============================================================== -->
        </section>
    </div>
    <div id="tabs-3">


        <div class="modal fade" id="modalDocuments" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
             aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">

                <!--Content-->
                <div class="modal-content">

                    <!--Body-->
                    <div class="modal-body mb-0 p-0">


                        <div class="row">
                            <div class="col-md-12 p-5">
                                <form>
                                    <fieldset>

                                        <input id="docid" type="hidden" value="" />






                                        <div class="form-group">
                                            <label for="DocumentName"><span class="req">* </span> Document Name:  </label>
                                            <input class="form-control" type="text" name="DocumentName" id="DocumentName" placeholder="Document Name" required />
                                            <div id="errLast"></div>
                                        </div>



                                        <div class="form-group  ">
                                            <label for="ImageUpload">Upload Douments</label><br>
                                            <input type="file" class="" id="ImageUpload" name="img" multiple>
                                        </div>

                                        <input type="hidden" class="" value="" id="ImageUploadnot" name="img">














                                        <div class="form-group">

                                            <input type="button" class="btn btn-success has-spinner" id="AddD" value="Add" />

                                            <div id="Editdocument" style="display:none">
                                                <input type="button" class="btn btn-success" id="updatedoc" value="Update" />

                                            </div>



                                        </div>





                                    </fieldset>
                                </form><!-- ends register form -->

                            </div><!-- ends col-6 -->


                        </div>


                    </div>

                    <!--Footer-->
                    <div class="modal-footer">
                        <button type="button" class=" btn btn-danger" data-dismiss="modal">Close</button>
                    </div>
                </div>

            </div>
            <!--/.Content-->

        </div>




        <section class="content">
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title"><button id="AddDocuments" class="btn-success" data-toggle='modal' data-target='#modalDocuments'>Add Documents</button></h3>
                        </div>
                        <!-- /.card-header -->
                        <div class="card-body">


                            <!-- Column -->




                            <table id="DoumentsTable" class="table table-bordered table-hover" style="width:100%">
                                <thead>
                                    <tr>
                                        <th>Document Name</th>

                                        <th>File</th>



                                        <th>Actions</th>

                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>





                    </div>
                </div>
            </div>
        </section>




    </div>
</div>


<div id="printpre" style="display:none">
    <style>

        .table {
            font-size: 12px !important;
        }
    </style>
    <div class="container" style="max-width: 760px!important; padding: 0px!important; max-height: 100vh!important;">


        <div class="row d-flex justify-content-center">



            @*<img src="~/Content/Synapse-Logo.png" class="img-fluid" style="width: 250px; height: 70px;" />*@

            <div style="width: 100%; height: 5px; background-color: #d0cece;"></div>



        </div>

        <div class="row d-flex text-center justify-content-center">

            <table class="table" style="border:0px solid black!important;">

                <tr style="border-top: none !important;">
                    <th style="border-top: none !important;">Name</th>
                    <td class="text-left" style="border-top: none !important;">Hasnain Ali</td>
                    <th class="text-right" style="border-top: none !important;">Medical Record (MR) Number:</th>
                    <td class="text-left" style="border-top: none !important;">Dr Altaf</td>
                </tr>

                <tr style="border-top: none !important;">
                    <th style="position: relative; left: -8px;border-top: none !important;">Age</th>
                    <td class="text-left" style="border-top: none !important;">19</td>
                    <th style="position: relative; left:20px;border-top: none !important;">Date:</th>
                    <td class="text-left" style="border-top: none !important;">27/07/21</td>
                </tr>



            </table>

            <div style="width: 100%; height: 5px; background-color: #d0cece;"></div>
        </div>





        <div class="row d-flex justify-content-center mt-2 ">

            <div class="text-center">

                <h3 style="text-decoration: underline; color: #a8a4a4;font-size:18px;">Treatment Plan</h3>
            </div>

            <table class="table mt-3">

                <tr style="position: relative; left: 20px; border-top: none!important;">

                    <th style="width: 200px;border-top: none!important;">Medication:</th>
                    <td style="border-top: none!important;">Test</td>

                </tr>

                <tr style="position: relative; left: 20px; border-top: none!important; top:20px;">

                    <th style="width: 200px;border-top: none!important;">Investigations:</th>
                    <td style="border-top: none!important;">Test</td>

                </tr>

                <tr style="position: relative; left: 20px; border-top: none!important;top:40px;">

                    <th style="width: 200px;border-top: none!important;">Referral:</th>
                    <td style="border-top: none!important;">Test</td>

                </tr>

                <tr style="position: relative; left: 20px; border-top: none!important;top:65px;">

                    <th style="width: 200px;border-top: none!important;">Advice:</th>
                    <td style="border-top: none!important;">Test</td>

                </tr>

                <tr style="position: relative; left: 20px; border-top: none!important; top:90px;">

                    <th style="width: 200px;border-top: none!important;">Return to Clinic (RTC):</th>
                    <td style="border-top: none!important;">Test</td>

                </tr>


            </table>

        </div>

        <div class="row d-flex justify-content-center" style="margin-top: 130px; margin-left: -98px;">

            <div class="col-md-6 d-flex justify-content-center">

                <b style="font-size: 12px;">Doctor's&nbsp;Name_________________________</b>
            </div>


            <div class="col-md-6 d-flex justify-content-center">

                <b style="font-size: 12px;">Doctor's&nbsp;Signature________________________</b>
            </div>

        </div>


        <div class="row d-flex justify-content-center" style="margin-top: 30px;">

            <h3 class="d-flex" style="letter-spacing: 10px;font-size: 19px;font-weight: 700;">REIMAGINING&nbsp;Connections&nbsp;<span>CIRCA 2021</span></h3>
            <div style="width: 100%; height: 5px; background-color: yellow;"></div>
            <h4 style="color: #a8a4a4; font-size: 12px;margin-top: 15px;">4th floor GPC, 13 Rojhan Street, Block 5 Clifton, Karachi, 75600, Pakistan | Phone: +92 304 1118000 | Email: contact@synapse.org.pk</h4>
        </div>



    </div>


</div>





<div id="editor"></div>


<script src="~/RichText/jquery-te-1.4.0.min.js"></script>
<script src="~/Scripts/notify.min.js"></script>
<script src="~/Content/datepicker.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.4.0/jspdf.min.js"></script>

<script>

    var apiurl = "@System.Configuration.ConfigurationManager.AppSettings["url"]";

  var pdfimg = "@System.Configuration.ConfigurationManager.AppSettings["pdfimg"]";
    function getQueryVariable(variable) {

        var query = window.location.search.substring(1);
        var vars = query.split("?");



        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if (pair[0] == variable) {
              return pair[1].replaceAll('%20', ' ');
            }
        }
    }

    var pid = "";


    var patientid = "";
    var appointmentId = "";
    $(document).ready(function () {
        $('.loader').hide()
   $("#tabs").tabs();




        var query = window.location.search.substring(1);
        var aa = query.split('&');

        var apId;

        var id = aa[0].split('=')
        debugger;

        if (aa[1] != undefined) {
            apId = aa[1].split('=');
            appointmentId = apId[1]
            $("#uls").append('<li><button class="btn btn-danger  has-spinner" id = "cencelappintment"> Cancel Appointment </button></li>');

        }


        patientid = id[1].replaceAll('%20', ' ')


        pid = patientid;

        followupspaginnation(patientid);
        DoumentPagination(patientid);
        prescriptionTablePage(patientid);
        $(".jqte-test").jqte();
        serachpateint();



        });


    /** DocumentRegion*/

    var filename = "";
    var base64stringform = "";

    var doc = "";

    function DoumentPagination(pid) {

        $("#DoumentsTable").DataTable({
            "bServerSide": true, //make server side processing to true
            "sAjaxSource": apiurl + "api/GetALLDocuments?id=" + pid,
            "sAjaxDataProp": "aaData", // data property of the returned ajax which contains table data
            "bProcessing": true,
            "bLengthChange": true,
            "sPaginationType": "full_numbers",//pagination type

            "aoColumns": [


                { "mData": "name" },


                {
                    "mData": "file", "bSearchable": false, "bSortable": false,
                    "mRender": function (data) {

                        var id = data;

                        return "<a  href = " + id + "     class='ml-2 btn btn-info btn-circle'><i class='fa fa-file'></i></a>";


                    }
                },



                {
                    "mData": "id", "bSearchable": false, "bSortable": false,
                    "mRender": function (data) {

                        var id = data;


                        return "<button type = 'button'   onclick='Editp(" + JSON.stringify(id) + ")'data-toggle='modal' data-target='#modalDocuments'  class='ml-2 btn btn-info btn-circle'><i class='fa fa-edit'></i></button>" + "<button type='button' class=' ml-2 btn btn-danger btn-circle'   onclick='DeletedDoc(" + JSON.stringify(id) + ")'> <i class='fa fa-trash-alt'></i></button > ";



                    }
                }



            ]
        });
    }


    $("#AddDocuments").click(function () {

        ClearFromFiledsDoc();
        cleardatavariablesDoc();

    })

    function Editp(ID) {
        ClearFromFiledsDoc();


      $("#AddD").hide();
      $("#Editdocument").css('display', "block");

            $.ajax({

              type: 'GET',
              url: apiurl+'api/getdocumentbyidPatient',
                data: {
                    id: ID
                },
                headers: {
                  'Content-Type': 'application/json',

                  'Access-Control-Allow-Origin': apiurl,
                    'Authorization': 'Bearer  @Request.Cookies["Token"].Value.ToString()'

                }


            }).done(function (res) {


                var data = JSON.parse(res.object);




              if (res.status == 'success') {


                $("#DocumentName").val(data[0].FileName);
                $('#ImageUploadnot').val(data[0].file_path);
                $('#docid').val(data[0].pkID);







                }
                else {
                    alert(res.message);

                }


            })
                .fail(function (XMLHttpRequest, textStatus, errorThrown) {


                    if (XMLHttpRequest.status==403) {
                        window.location.href = '~/Account/Login'
                    }

                    if (XMLHttpRequest.status == 401) {
                        window.location.href = '/Account/Login'
                    }

                    console.log("fail");


                })




    }


    $(document).on("change", "#ImageUpload", function () {

        fasterPreview(this, "Document");

    })

    $("#AddD").click(function () {


        filename = $('#DocumentName').val();


            $.ajax({

              type: 'POST',

              url: apiurl+'api/ADDocument',
                data: JSON.stringify({


                    Name: filename,
                    PID: pid,
                    file: base64stringform,


                }),
                headers: {
                  'Content-Type': 'application/json',
                  'Access-Control-Allow-Origin': apiurl,

                    'Authorization': 'Bearer  @Request.Cookies["Token"].Value.ToString()'

                }


            }).done(function (res) {

                if (res.status == 'success') {

                    $("#imgeloderPatient").hide();
                    alert('Added');

                    ClearFromFiledsDoc();
                    cleardatavariablesDoc();
                    base64stringform = [];

                    setTimeout(function () {
                        $(btn).buttonLoader('stop');
                    }, 3000);
                    window.location.reload();

                }
                else {
                    alert(res.message);

                }


            })
                .fail(function (XMLHttpRequest, textStatus, errorThrown) {


                    if (XMLHttpRequest.status==403) {
                        window.location.href = '~/Account/Login'
                    }

                    if (XMLHttpRequest.status == 401) {
                        window.location.href = '/Account/Login'
                    }

                    console.log("fail");


                })



    });








    function fasterPreview(uploader, component) {
        debugger;
        if (uploader.files && uploader.files[0]) {
            var fileName, fileExtension;
            fileName = uploader.files[0].name;
            fileExtension = fileName.replace(/^.*\./, '');

            var FileSize = uploader.files[0].size / 1024 / 1024; // in MB
            if (FileSize > 10) {
                alert('File size exceeds 10 MB');
                uploader.val('');
                if (component == "Document")
                    base64stringform = "";

                return false;
            }
            var img = uploader.files[0];
            var reader = new FileReader();
            reader.onloadend = function () {
                //var mybase64String = /,(.+)/.exec(reader.result)[1];
                //base64String.push(/,(.+)/.exec(reader.result)[1]);
                if (component == "Document")
                       base64stringform= /,(.+)/.exec(reader.result)[1];

            }
            reader.readAsDataURL(img);

        }



    }



    $(document).on("click", "#updatedoc",function () {

        if ($('#DocumentName').val() == '') {
            isAllOkay = false;

            alert('Document Name is  Mandatory!');
            return;
        }




        updateDoc();

    })



    function updateDoc() {



        filename = $('#DocumentName').val();

        doc = $("#ImageUploadnot").val();

      var docid = $("#docid").val();

            $.ajax({

                type: 'POST',
                url: apiurl + 'api/UpdateDoc',
                //url: 'http://webapi.compassioncouch.com/api/UpdateDoc',
                data: JSON.stringify({

                    ID: docid,
                    Name:filename,

                    file:base64stringform,
                    Doc:doc


                }),
                headers: {
                  'Content-Type': 'application/json',
                  'Access-Control-Allow-Origin': 'https://localhost:44306/',
                    //'Access-Control-Allow-Origin': 'http://webapi.compassioncouch.com/',
                    'Authorization': 'Bearer  @Request.Cookies["Token"].Value.ToString()'

                }


            }).done(function (res) {

                if (res.status == 'success') {

                    $("#imgeloderPatient").hide();
                    alert('updated');
                    base64stringform = "";

                    ClearFromFiledsDoc();
                    cleardatavariablesDoc();

                    setTimeout(function () {
                        $(btn).buttonLoader('stop');
                    }, 3000);
                    window.location.reload();

                }
                else {
                    alert(res.message);

                }


            })
                .fail(function (XMLHttpRequest, textStatus, errorThrown) {


                    if (XMLHttpRequest.status==403) {
                        window.location.href = '~/Account/Login'
                    }

                    if (XMLHttpRequest.status == 401) {
                        window.location.href = '/Account/Login'
                    }

                    console.log("fail");


                })


    }


    function ClearFromFiledsDoc() {

        $('#DocumentName').val('');


    }

    function cleardatavariablesDoc() {


        filename = "";
        base64stringform = "";

    }





    function DeletedDoc(ID) {

            $.ajax({

                type: 'get',
                url: apiurl + 'api/DeleteIDDoc',
                data:{

                    id:ID


                },
                headers: {
                    'Content-Type': 'application/json',
                    'Access-Control-Allow-Origin': apiurl,
                    'Authorization': 'Bearer  @Request.Cookies["Token"].Value.ToString()'

                }


            }).done(function (res) {

                if (res.status == 'success') {

                    $("#imgeloderPatient").hide();
                    alert('Deleted');
                    window.location.reload();
                }
                else {
                    alert(res.message);

                }


            })
                .fail(function (XMLHttpRequest, textStatus, errorThrown) {


                    if (XMLHttpRequest.status==403) {
                        window.location.href = '~/Account/Login'
                    }

                    if (XMLHttpRequest.status == 401) {
                        window.location.href = '/Account/Login'
                    }

                    console.log("fail");


                })

    }




  $("#pushmenudash").click(function () {

    var id = $(this).attr('data-id');


    var a = $('#bodytocheckclass').hasClass('sidebar-collapse');

    if (a == true) {

      $('#bodytocheckclass').removeClass('sidebar-mini layout-fixed  sidebar-collapse');
      $('#bodytocheckclass').addClass('sidebar-mini layout-fixed  ')
    }

    else {

      $('#bodytocheckclass').removeClass('sidebar-mini layout-fixed  ');
      $('#bodytocheckclass').addClass('sidebar-mini layout-fixed  sidebar-collapse ')
    }

  });
    /** DocumentRegion*/










    function followupspaginnation(patientid) {
        $("#Followtupstable").DataTable({
            "bServerSide": true, //make server side processing to true

            "sAjaxSource": apiurl + "api/GetFollowupAnalysisPage?id=" + patientid,
            //url of the Ajax source,i.e. web api method
            "sAjaxDataProp": "aaData", // data property of the returned ajax which contains table data
            "bProcessing": true,
            "bLengthChange": true,
            "sPaginationType": "full_numbers",//pagination type

            "aoColumns": [



                {
                    "mData": "currentMedication", "bSearchable": false, "bSortable": false,
                    "mRender": function (data) {
                        var htmlEntities4 = data;
                        if (htmlEntities4 != '') {
                            var htmlDecode4 = $.parseHTML(htmlEntities4)[0]['wholeText'];



                            return "<td>" + htmlDecode4 + "</td>"

                        }
                        else {



                            return ""
                        }

                    }
                },



                {
                    "mData": "progressiveNote", "bSearchable": false, "bSortable": false,
                    "mRender": function (data) {
                        var htmlEntities4 = data;
                        if (htmlEntities4 != '') {
                            var htmlDecode4 = $.parseHTML(htmlEntities4)[0]['wholeText'];



                            return "<td>" + htmlDecode4 + "</td>"

                        }
                        else {



                            return ""
                        }

                    }
                },





                //{
                //    "mData": "subjective", "bSearchable": false, "bSortable": false,
                //    "mRender": function (data) {
                //        var htmlEntities4 = data;
                //        if (htmlEntities4 != '') {
                //            var htmlDecode4 = $.parseHTML(htmlEntities4)[0]['wholeText'];



                //            return "<td>" + htmlDecode4 + "</td>"

                //        }
                //        else {



                //            return ""
                //        }

                //    }
                //},

                //{ "mData": "objectiveandMentalStateExamination" },

                { "mData": "date" },


                {
                    "mData": "pkid", "bSearchable": false, "bSortable": false,
                    "mRender": function (data) {



                        return "<button class='btn btn-success' data-toggle='modal' data-target='#modalFollowups' onclick='EditA(" + JSON.stringify(data) + ")'>Edit</button>"

                    }
                }




            ]
        });

    }




    $(".FollowupAnalysis").click(function () {

    $("#FollowupAnalysisbtn").show();
    $("#Editfollowps").hide();
    $("#PkID").val('');
    $("#PateintID").val('');
      $("#CurrentMedication").jqteVal('');

      $("#ProgressiveNote").jqteVal('');
      $("#Subjective").jqteVal('');
      $("#ObjectiveandMentalStateExamination").jqteVal('');
      $("#Assessment").jqteVal('');
      $("#Plan").jqteVal('');



  });


    $(document).on("click", "#FollowupAnalysisbtn", function () {

        var pateintID = $("#PateintID").val();
        var CurrentMedication = $("#CurrentMedication").val();
        var Subjective = $("#Subjective").val();
        var ProgressiveNote = $("#ProgressiveNote").val();
        var ObjectiveandMentalStateExamination = $("#ObjectiveandMentalStateExamination").val();
        var Assessment = $("#Assessment").val();
        var Plan = $("#Plan").val();



            $.ajax({

              type: 'POST',
              url: apiurl+'api/AddFollowupAnalysis',

                data: JSON.stringify({
                    CurrentMedication: CurrentMedication,
                    ProgressiveNote: ProgressiveNote,

                    Subjective: Subjective,

                    ObjectiveandMentalStateExamination: ObjectiveandMentalStateExamination,
                    Assessment: Assessment,
                    Plan: Plan,
                    PatientID: patientid

                }),
                headers: {
                  'Content-Type': 'application/json',
                  'Access-Control-Allow-Origin': apiurl,

                    'Authorization': 'Bearer  @Request.Cookies["Token"].Value.ToString()'

                }


            }).done(function (res) {

                if (res.status == 'success') {



                    $("#Followtupstable").DataTable().ajax.reload();

                    swal({
                        title: "Saved",

                        icon: "success",
                    });
                    ClearFromFiledsFollowups();

                    $("#modalFollowups").modal('hide');



                }
                else {
                    alert(res.message);

                }


            })
                .fail(function (XMLHttpRequest, textStatus, errorThrown) {


                    if (XMLHttpRequest.status==403) {
                        window.location.href = '~/Account/Login'
                    }

                    if (XMLHttpRequest.status == 401) {
                        window.location.href = '/Account/Login'
                    }

                    console.log("fail");


                })





    });








  function EditA(id) {
    $("#FollowupAnalysisbtn").hide();
    $("#Editfollowps").css('display','block');
    ClearFromFiledsFollowups();
        $.ajax({

            type: "Get",
          url: apiurl+"api/GetFollowupAnalysisbyID",

                data: {

                    id:id

            },

                headers: {
                    'Content-Type': 'application/json',
                  'Access-Control-Allow-Origin': apiurl,
                    'Authorization': 'Bearer  @Request.Cookies["Token"].Value.ToString()'

                }


            }).done(function (res) {


                var data = JSON.parse(res.object);



                if (res.status == 'success') {





                  $("#PkID").val(data[0].PkID);
                    $("#PateintID").val(data[0].PatientID);

                    var htmlEntities3 = data[0].CurrentMedication;

                    if (htmlEntities3!='') {
                        var htmlDecode3 = $.parseHTML(htmlEntities3)[0]['wholeText'];


                        $("#CurrentMedication").jqteVal(htmlDecode3);

                    }



                    var htmlEntities4 = data[0].ProgressiveNote;
                    if (htmlEntities4!='') {
                        var htmlDecode4 = $.parseHTML(htmlEntities4)[0]['wholeText'];



                        $("#ProgressiveNote").jqteVal(htmlDecode4);

                    }



                    var htmlEntities5 = data[0].Subjective;


                    if (htmlEntities5!='') {
                        var htmlDecode5 = $.parseHTML(htmlEntities5)[0]['wholeText'];



                        $("#Subjective").jqteVal(htmlDecode5);
                    }



                    var htmlEntities6 = data[0].ObjectiveandMentalStateExamination;
                    if (htmlEntities6!='') {
                        var htmlDecode6 = $.parseHTML(htmlEntities6)[0]['wholeText'];


                        $("#ObjectiveandMentalStateExamination").jqteVal(htmlDecode6);
                    }



                    var htmlEntities = data[0].Assessment;

                    if (htmlEntities!='') {
                        var htmlDecode = $.parseHTML(htmlEntities)[0]['wholeText'];

                        $("#Assessment").jqteVal(htmlDecode);


                    }



                    var htmlEntities2 = data[0].Plan;

                    if (htmlEntities2!='') {
                        var htmlDecode2 = $.parseHTML(htmlEntities2)[0]['wholeText'];




                        $("#Plan").jqteVal(htmlDecode2);


                    }






                }
                else {
                    alert(res.message);

                }


            })
                .fail(function (XMLHttpRequest, textStatus, errorThrown) {


                    if (XMLHttpRequest.status==403) {
                        window.location.href = '~/Account/Login'
                    }

                    if (XMLHttpRequest.status == 401) {
                        window.location.href = '/Account/Login'
                    }

                    console.log("fail");


                })











    }



    $(document).on("click", "#EditFollowupAnalysisbtn", function () {
        var pkid = $("#PkID").val();
        var pateintID = $("#PateintID").val();
        var CurrentMedication = $("#CurrentMedication").val();
        var Subjective = $("#Subjective").val();
        var ProgressiveNote = $("#ProgressiveNote").val();
        var ObjectiveandMentalStateExamination = $("#ObjectiveandMentalStateExamination").val();
        var Assessment = $("#Assessment").val();
        var Plan = $("#Plan").val();



            $.ajax({

              type: 'POST',

              url: apiurl+'api/UpdateFollowupAnalysis',

                data: JSON.stringify({
                    CurrentMedication: CurrentMedication,
                    ProgressiveNote: ProgressiveNote,

                    Subjective: Subjective,

                    ObjectiveandMentalStateExamination: ObjectiveandMentalStateExamination,
                    Assessment: Assessment,
                    Plan: Plan,
                    PatientID: pateintID,
                    pkid: pkid

                }),
                headers: {
                  'Content-Type': 'application/json',
                  'Access-Control-Allow-Origin': apiurl,

                    'Authorization': 'Bearer  @Request.Cookies["Token"].Value.ToString()'

                }


            }).done(function (res) {

                if (res.status == 'success') {

                    $("#Followtupstable").DataTable().ajax.reload();

                    swal({
                        title: "Saved",

                        icon: "success",
                    });
                    ClearFromFiledsFollowups();

                    $("#modalFollowups").modal('hide');


                }
                else {
                    alert(res.message);

                }


            })
                .fail(function (XMLHttpRequest, textStatus, errorThrown) {


                    if (XMLHttpRequest.status==403) {
                        window.location.href = '~/Account/Login'
                    }

                    if (XMLHttpRequest.status == 401) {
                        window.location.href = '/Account/Login'
                    }

                    console.log("fail");


                })








    });




    $(".Initial_Analysiz").click(function () {

        $('.loader').show()
                $.ajax({
            type: 'GET',
                  url: apiurl+'api/IsInitialAnalysized',


                   data: {




                       id: patientid

                },
                headers: {
                  'Content-Type': 'application/json',
                  'Access-Control-Allow-Origin': apiurl,
                    'Authorization': 'Bearer  @Request.Cookies["Token"].Value.ToString()'

                }


           }).done(function (res) {


               if (res.status == 'success') {
                   $('.loader').hide()
                   $('#Initial_Analysiz1').empty();

                   $('#myModal5').modal('show');

                var data = JSON.parse(res.object);



                   var html = `
<form >


<input type="hidden" name="ID" value="`+ data[0].PkID + `" id="IDD" />

    <input type="hidden" name="Pid" value="`+ data[0].Pid + `" />

    <div class="form-group">
        <label>Name OF Interviewer</label>
        <input  type="text" class="form-control jqte-test1" name="NameOFInterviewert" value=""   id="NameOFInterviewert">
    </div>

    <div class="form-group">
        <label>DateTime</label>
        <input  type="date" class="form-control" name="DateTime" value=""  id="DateTime">
    </div>


    <div class="form-group">
        <label>Present Complaint</label>
        <input  type="text" class="form-control jqte-test1" name="Present_Complaint" value=""  placeholder="Present Complaint" id="Present_Complaint">
    </div>
    <div class="form-group">
        <label>History of Presenting Complaint</label>
        <input type="text" class="form-control jqte-test1" name="History_of_Presenting_Complaint"  value=""  placeholder="History of Presenting Complaint" id="History_of_Presenting_Complaint">
    </div>



    <div class="form-group">
        <label>Past Psychiatric History</label>
        <input type="text" class="form-control jqte-test1 Past_psychiatric_history" name="Past_psychiatric_history" value="" placeholder="Past Psychiatric History" id="Past_Psychiatric_History">
    </div>







    <div class="form-group">
        <label>Current Medication</label>
        <input type="text" class="form-control jqte-test1" name="Current_Medication" value="" placeholder="Current Medication" id="Current_Medication">
    </div>



    <div class="form-group">
        <label>Physical History</label>

        <textarea class="form-control jqte-test1" name="Physical_History " id="Physical_History"   rows="3"> </textarea>


    </div>


    <div class="form-group">
        <label>Family History</label>

        <textarea class="form-control jqte-test1" name="Family_History" id="Family_History"    rows="3"></textarea>


    </div>



    <div class="form-group">
        <label>Education</label>
        <input type="text" class="form-control jqte-test1" name="schooling" placeholder="schooling" value=""  id="schooling">
    </div>





    <div class="form-group">
        <label>Maritial Status</label>

        <input   class="form-control" value="`+ data[0].MaritialStatus +`"  id="Maritial_Status"/>

    </div>



    <div class="form-group">
        <label>Birth and early childhood</label>
        <input type="text" class="form-control jqte-test1" name="Adolesence" placeholder="Birthandearlychildhood" id="Birthandearlychildhood">
    </div>



    <div class="form-group">
        <label>Adolesence</label>
        <input type="text" class="form-control jqte-test1" value="" name="Adolesence" placeholder="Adolesence" id="Adolesence">
    </div>

    <div class="form-group">
        <label>Occupation</label>
        <input type="text" class="form-control jqte-test1" value="" name="occupation" placeholder="occupation" id="occupation">
    </div>




    <div class="form-group">
        <label>Alcohal / Substance abuse</label>
        <input type="text" class="form-control jqte-test1" name="AlcohalSubstance_abuse"  value="" placeholder="Alcohal / Substance abuse" id="Alcohal">
    </div>




    <div class="form-group">
        <label>Premorbid personality</label>
        <input type="text" class="form-control jqte-test1" name="Premorbid_personality" value="" placeholder="Premorbid personality" id="Premorbid_personality">
    </div>




    <div class="form-group">
        <label>Mental State Examination</label>
        <input type="text" class="form-control jqte-test1" name="Mental_State_Examination"  value="" placeholder="Mental State Examination" id="Mental_State_Examination">
    </div>


    <div class="form-group">
        <label>Appearance and Behavior</label>
        <input type="text" class="form-control jqte-test1" name="Appearance_and_Behavior"  value="" placeholder="Appearance and Behavior" id="Appearance_and_Behavior">
    </div>


    <div class="form-group">
        <label>Speech</label>
        <input type="text" class="form-control jqte-test1" name="Speech"  value="" placeholder="Speech" id="Speech">
    </div>



    <div class="form-group">
        <label>Mood and Affect</label>
        <input type="text" class="form-control jqte-test1" name="Mood_and_Affect" value="" placeholder="Mood and Affect" id="Mood_and_Affect">
    </div>



    <div class="form-group">
        <label>Sucidial ideations</label>
        <input type="text" class="form-control jqte-test1" name="Sucidial_ideations"  value="" placeholder="Sucidial ideations" id="Sucidial_ideations">
    </div>




    <div class="form-group">
        <label>Thoughts</label>
        <input type="text" class="form-control jqte-test1" name="Thoughts"  value="" placeholder="Thoughts" id="Thoughts">
    </div>







    <div class="form-group">
        <label>Delusions</label>
        <input type="text" class="form-control jqte-test1" name="Delusions" value="" placeholder="Delusions" id="Delusions">
    </div>



    <div class="form-group">
        <label>Hallucinations</label>
        <input type="text" class="form-control jqte-test1"   name="hallucinations"  value="" placeholder="Hallucinations" id="hallucinations">
    </div>

    <div class="form-group">
        <label>Insight</label>
        <input type="text" class="form-control jqte-test1" name="Insight" value="" placeholder="Insight" id="Insight">
    </div>



    <div class="form-group">
        <label>Cognitions</label>
        <input type="text" class="form-control jqte-test1" name="Cognitions" value="" placeholder="Cognitions" id="Cognitions">
    </div>

    <div class="form-group">
        <label>Provisional Diagnosis</label>
        <input type="text" class="form-control jqte-test1" name="Provisional_Diagnosis" value=""  placeholder="Provisional Diagnosis" id="Provisional_Diagnosis">
    </div>

    <div class="form-group">
        <label>Differential Diagnosis</label>
        <input type="text" class="form-control jqte-test1" name="differential_diagnosis"   value="" placeholder="differential diagnosis" id="differential_diagnosis">
    </div>

    <button type="button" id="submitbtn" class="btn btn-primary">Submit</button>
</form>

`;


                   $("#Initial_Analysiz1").append(html);

                   $(".jqte-test1").jqte();



                   var IhtmlEntities1 = data[0].Present_Complaint;

                   if (IhtmlEntities1!='') {
                       var IhtmlDecode1 = $.parseHTML(IhtmlEntities1)[0]['wholeText'];


                       $("#Present_Complaint").jqteVal(IhtmlDecode1);

                   }


                   //
                   var IhtmlEntities2 = data[0].History_of_Presenting_Complaint;

                   if (IhtmlEntities2 != '') {
                       var IhtmlDecode2 = $.parseHTML(IhtmlEntities2)[0]['wholeText'];


                       $("#History_of_Presenting_Complaint").jqteVal(IhtmlDecode2);

                   }




                   //
                   var IhtmlEntities3 = data[0].Past_psychiatric_history;

                   if (IhtmlEntities3!='') {
                       var IhtmlDecode3 = $.parseHTML(IhtmlEntities3)[0]['wholeText'];


                       $(".Past_psychiatric_history").jqteVal(IhtmlDecode3);

                   }


                   //

                   var IhtmlEntities4 = data[0].Current_Medication;

                   if (IhtmlEntities4!='') {
                       var IhtmlDecode4 = $.parseHTML(IhtmlEntities4)[0]['wholeText'];


                       $("#Current_Medication").jqteVal(IhtmlDecode4);

                   }

                   //



                   var IhtmlEntities5 = data[0].Physical_History;


                   if (IhtmlEntities5!='') {
                       var IhtmlDecode5 = $.parseHTML(IhtmlEntities5)[0]['wholeText'];


                       $("#Physical_History").jqteVal(IhtmlDecode5);

                   }
                   //




                   var IhtmlEntities6 = data[0].Family_History;


                   if (IhtmlEntities6!='') {
                       var IhtmlDecode6 = $.parseHTML(IhtmlEntities6)[0]['wholeText'];


                       $("#Family_History").jqteVal(IhtmlDecode6);

                   }

                   //





                   var IhtmlEntities7 = data[0].schooling;

                   if (IhtmlEntities7!='') {

                       var IhtmlDecode7 = $.parseHTML(IhtmlEntities7)[0]['wholeText'];

                       $("#schooling").jqteVal(IhtmlDecode7);
                   }


                   //





                   var IhtmlEntities8 = data[0].Adolesence;

                   if (IhtmlEntities8!='') {

                       var IhtmlDecode8 = $.parseHTML(IhtmlEntities8)[0]['wholeText'];

                       $("#Adolesence").jqteVal(IhtmlDecode8);
                   }
                   //







                   var IhtmlEntities9 = data[0].Alcohal_Substance_abuse;

                   if (IhtmlEntities9!='') {

                       var IhtmlDecode9 = $.parseHTML(IhtmlEntities9)[0]['wholeText'];

                       $("#Alcohal").jqteVal(IhtmlDecode9);
                   }


                   //

                   var IhtmlEntities10 = data[0].Premorbid_personality;


                   if (IhtmlEntities10!='') {

                       var IhtmlDecode10 = $.parseHTML(IhtmlEntities10)[0]['wholeText'];

                       $("#Premorbid_personality").jqteVal(IhtmlDecode10);
                   }
                   //





                   var IhtmlEntities11 = data[0].Mental_State_Examination;


                   if (IhtmlEntities11!='') {

                       var IhtmlDecode11 = $.parseHTML(IhtmlEntities11)[0]['wholeText'];

                       $("#Mental_State_Examination").jqteVal(IhtmlDecode11);
                   }

                   //




                   var IhtmlEntities12 = data[0].Appearance_and_Behavior;

                   if (IhtmlEntities12!='') {


                       var IhtmlDecode12 = $.parseHTML(IhtmlEntities12)[0]['wholeText'];

                       $("#Appearance_and_Behavior").jqteVal(IhtmlDecode12);
                   }

                   //






                   var IhtmlEntities13 = data[0].Speech;


                   if (IhtmlEntities13!='') {

                       var IhtmlDecode13 = $.parseHTML(IhtmlEntities13)[0]['wholeText'];

                       $("#Speech").jqteVal(IhtmlDecode13);
                   }


                   //




                   var IhtmlEntities14 = data[0].Mood_and_Affect;

                   if (IhtmlEntities14!='') {

                       var IhtmlDecode14 = $.parseHTML(IhtmlEntities14)[0]['wholeText'];

                       $("#Mood_and_Affect").jqteVal(IhtmlDecode14);
                   }


                   //




                   var IhtmlEntities15 = data[0].Sucidial_ideations;

                   if (IhtmlEntities15!='') {

                       var IhtmlDecode15 = $.parseHTML(IhtmlEntities15)[0]['wholeText'];

                       $("#Sucidial_ideations").jqteVal(IhtmlDecode15);
                   }






                   //



                   var IhtmlEntities16 = data[0].Thoughts;

                   if (IhtmlEntities16!='') {

                       var IhtmlDecode16 = $.parseHTML(IhtmlEntities16)[0]['wholeText'];

                       $("#Thoughts").jqteVal(IhtmlDecode16);
                   }

                   //data[0].Delusions



                   var IhtmlEntities17 = data[0].Delusions;
                   if (IhtmlEntities17!='') {

                       var IhtmlDecode17 = $.parseHTML(IhtmlEntities17)[0]['wholeText'];

                       $("#Delusions").jqteVal(IhtmlDecode17);
                   }

                   //




                   var IhtmlEntities18 = data[0].hallucinations;

                   if (IhtmlEntities18!='') {

                       var IhtmlDecode18 = $.parseHTML(IhtmlEntities18)[0]['wholeText'];

                       $("#hallucinations").jqteVal(IhtmlDecode18);
                   }
                   //




                   var IhtmlEntities19 = data[0].Insight;
                   if (IhtmlEntities19!='') {

                       var IhtmlDecode19 = $.parseHTML(IhtmlEntities19)[0]['wholeText'];

                       $("#Insight").jqteVal(IhtmlDecode19);
                   }

                   //





                   var IhtmlEntities20 = data[0].Cognitions;

                   if (IhtmlEntities20!='') {

                       var IhtmlDecode20 = $.parseHTML(IhtmlEntities20)[0]['wholeText'];

                       $("#Cognitions").jqteVal(IhtmlDecode20);
                   }

                   //




                   var IhtmlEntities21 = data[0].Provisional_Diagnosis;
                   if (IhtmlEntities21!='') {

                       var IhtmlDecode21 = $.parseHTML(IhtmlEntities21)[0]['wholeText'];

                       $("#Provisional_Diagnosis").jqteVal(IhtmlDecode21);
                   }

                   //



                   var IhtmlEntities22 = data[0].differential_diagnosis;

                   if (IhtmlEntities22!='') {

                       var IhtmlDecode22 = $.parseHTML(IhtmlEntities22)[0]['wholeText'];

                       $("#differential_diagnosis").jqteVal(IhtmlDecode22);
                   }




                   var IhtmlEntities23 = data[0].Bir_ae_child;

                   if (IhtmlEntities23 != '') {

                       var IhtmlEntities23 = $.parseHTML(IhtmlEntities23)[0]['wholeText'];

                       $("#Birthandearlychildhood").jqteVal(IhtmlEntities23);
                   }



                   var IhtmlEntities24 = data[0].occupation;

                   if (IhtmlEntities24 != '') {

                       var IhtmlEntities24 = $.parseHTML(IhtmlEntities24)[0]['wholeText'];

                       $("#occupation").jqteVal(IhtmlEntities24);
                   }
                   var IhtmlEntities25 = data[0].Name_Of_interviewer;

                   if (IhtmlEntities25 != '') {

                       var IhtmlEntities25 = $.parseHTML(IhtmlEntities25)[0]['wholeText'];

                       $("#NameOFInterviewert").jqteVal(IhtmlEntities25);
                   }




                       $("#DateTime").val(data[0].CreatedDate);



               }


            else if (res.status=="no") {

                   $('.loader').hide()
                   $('#Initial_Analysiz1').empty();

                   $('#myModal5').modal('show');


                   var html = `


<form id="IA">

    <input type="hidden" name="Pid" value="" />



    <div class="form-group">
        <label>Name OF Interviewer</label>
        <input  type="text" class="form-control jqte-test1" name="NameOFInterviewert" value=""   id="NameOFInterviewert">
    </div>

    <div class="form-group">
        <label>DateTime</label>
        <input  type="date" class="form-control" name="DateTime" value=""  id="DateTime">
    </div>


    <div class="form-group">
        <label>Present Complaint</label>
        <input type="text" class="form-control jqte-test1" name="Present_Complaint" placeholder="Present Complaint" id="Present_Complaint">
    </div>
    <div class="form-group">
        <label>History of Presenting Complaint</label>
        <input type="text" class="form-control jqte-test1" name="History_of_Presenting_Complaint" placeholder="History of Presenting Complaint" id="History_of_Presenting_Complaint">
    </div>



    <div class="form-group">
        <label>Past Psychiatric History</label>
        <input type="text" class="form-control jqte-test1" name="
" placeholder="Past Psychiatric History" id="Past_Psychiatric_History">
    </div>







    <div class="form-group">
        <label>Current Medication</label>
        <input type="text" class="form-control jqte-test1" name="Current_Medication" placeholder="Current Medication" id="Current_Medication">
    </div>



    <div class="form-group">
        <label>Physical History</label>

        <textarea class="form-control jqte-test1" name="Physical_History" id="Physical_History" rows="3"></textarea>


    </div>


    <div class="form-group">
        <label>Family History</label>

        <textarea class="form-control jqte-test1" name="Family_History" id="Family_History" rows="3"></textarea>


    </div>



    <div class="form-group">
        <label>Education</label>
        <input type="text" class="form-control jqte-test1" name="schooling" placeholder="schooling" id="schooling">
    </div>



    <div class="form-group">
        <label>Maritial Status</label>

        <select   class="form-control" id="Maritial_Status">

            <option class="form-control" value="Single">Single</option>
            <option class="form-control" value="Married">Married</option>
            <option class="form-control" value="Divorced">Divorced</option>

        </select>

    </div>



    <div class="form-group">
        <label>Birth and early childhood</label>
        <input type="text" class="form-control jqte-test1" name="childhood" placeholder="Birthandearlychildhood" id="Birthandearlychildhood">
    </div>



    <div class="form-group">
        <label>Adolesence</label>
        <input type="text" class="form-control jqte-test1" name="Adolesence" placeholder="Adolesence" id="Adolesence">
    </div>


    <div class="form-group">
        <label>Occupation</label>
        <input type="text" class="form-control jqte-test1" value="" name="occupation" placeholder="occupation" id="occupation">
    </div>



    <div class="form-group">
        <label>Alcohal / Substance abuse</label>
        <input type="text" class="form-control jqte-test1" name="AlcohalSubstance_abuse" placeholder="Alcohal / Substance abuse" id="Alcohal">
    </div>




    <div class="form-group">
        <label>Premorbid personality</label>
        <input type="text" class="form-control jqte-test1" name="Premorbid_personality" placeholder="Premorbid personality" id="Premorbid_personality">
    </div>




    <div class="form-group">
        <label>Mental State Examination</label>
        <input type="text" class="form-control jqte-test1" name="Mental_State_Examination" placeholder="Mental State Examination" id="Mental_State_Examination">
    </div>


    <div class="form-group">
        <label>Appearance and Behavior</label>
        <input type="text" class="form-control jqte-test1" name="Appearance_and_Behavior" placeholder="Appearance and Behavior" id="Appearance_and_Behavior">
    </div>


    <div class="form-group">
        <label>Speech</label>
        <input type="text" class="form-control jqte-test1" name="Speech" placeholder="Speech" id="Speech">
    </div>



    <div class="form-group">
        <label>Mood and Affect</label>
        <input type="text" class="form-control   jqte-test1" name="Mood_and_Affect" placeholder="Mood and Affect" id="Mood_and_Affect">
    </div>



    <div class="form-group">
        <label>Sucidial ideations</label>
        <input type="text" class="form-control  jqte-test1" name="Sucidial_ideations" placeholder="Sucidial ideations" id="Sucidial_ideations">
    </div>




    <div class="form-group">
        <label>Thoughts</label>
        <input type="text" class="form-control jqte-test1" name="Thoughts" placeholder="Thoughts" id="Thoughts">
    </div>







    <div class="form-group">
        <label>Delusions</label>
        <input type="text" class="form-control jqte-test1" name="Delusions" placeholder="Delusions" id="Delusions">
    </div>



    <div class="form-group">
        <label>Hallucinations</label>
        <input type="text" class="form-control jqte-test1" name="hallucinations" placeholder="Hallucinations" id="hallucinations">
    </div>

    <div class="form-group">
        <label>Insight</label>
        <input type="text" class="form-control jqte-test1" name="Insight" placeholder="Insight" id="Insight">
    </div>



    <div class="form-group">
        <label>Cognitions</label>
        <input type="text" class="form-control jqte-test1 " name="Cognitions" placeholder="Cognitions" id="Cognitions">
    </div>

    <div class="form-group">
        <label>Provisional Diagnosis</label>
        <input type="text" class="form-control jqte-test1 " name="Provisional_Diagnosis" placeholder="Provisional Diagnosis" id="Provisional_Diagnosis">
    </div>

    <div class="form-group">
        <label>Differential Diagnosis</label>
        <input type="text" class="form-control jqte-test1 " name="differential_diagnosis" placeholder="differential diagnosis" id="differential_diagnosis">
    </div>

    <button type="button" id="submitbtnADD" class="btn btn-primary">Submit</button>
</form>


`;


                   $("#Initial_Analysiz1").append(html);


                   $(".jqte-test1").jqte();

               }


            else {





                alert(res.message);


            }


            })
                .fail(function (XMLHttpRequest, textStatus, errorThrown) {


                    if (XMLHttpRequest.status==403) {
                        window.location.href = '~/Account/Login'
                    }

                    if (XMLHttpRequest.status == 401) {
                        window.location.href = '/Account/Login'
                    }

                    console.log("fail");


                })




    });

    //submitbtnADD

    $(document).on('click',"#submitbtnADD",function () {



        var Present_Complaint = $("#Present_Complaint").val();
        var History_of_Presenting_Complaint = $("#History_of_Presenting_Complaint").val();
        var Past_Psychiatric_History = $("#Past_Psychiatric_History").val();
        var Current_Medication = $("#Current_Medication").val();
        var Physical_History = $("#Physical_History").val();
        var Family_History = $("#Family_History").val();
        var schooling = $("#schooling").val();
        var Maritial_Status = $("#Maritial_Status").val();
        var Adolesence = $("#Adolesence").val();
        var Alcohal = $("#Alcohal").val();
        var Premorbid_personality = $("#Premorbid_personality").val();
        var Mental_State_Examination = $("#Mental_State_Examination").val();
        var Appearance_and_Behavior = $("#Appearance_and_Behavior").val();
        var Speech = $("#Speech").val();
        var Mood_and_Affect = $("#Mood_and_Affect").val();
        var Sucidial_ideations = $("#Sucidial_ideations").val();
        var Thoughts = $("#Thoughts").val();

        var Delusions = $("#Delusions").val();

        var hallucinations = $("#hallucinations").val();

        var Insight = $("#Insight").val();

        var Cognitions = $("#Cognitions").val();

        var Provisional_Diagnosis = $("#Provisional_Diagnosis").val();


        var differential_diagnosis = $("#differential_diagnosis").val();
        var occupation = $("#occupation").val();
        var Birthandearlychildhood = $("#Birthandearlychildhood").val();
        var  NameOFInterviewert = $("#NameOFInterviewert").val();
        var datetime =$("#DateTime").val()

        var data = {

            Pid: patientid,
            Present_Complaint: Present_Complaint,
            History_of_Presenting_Complaint: History_of_Presenting_Complaint,
            Past_Psychiatric_History: Past_Psychiatric_History,
            Current_Medication: Current_Medication,
            Physical_History: Physical_History,
            Family_History: Family_History,
            schooling: schooling,
            Maritial_Status: Maritial_Status,
            Adolesence: Adolesence,
            AlcohalSubstance_abuse: Alcohal,
            Premorbid_personality: Premorbid_personality,
            Mental_State_Examination: Mental_State_Examination,
            Appearance_and_Behavior: Appearance_and_Behavior,

            Speech: Speech,

            Mood_and_Affect: Mood_and_Affect,


            Sucidial_ideations: Sucidial_ideations,

            Thoughts: Thoughts,

            Delusions: Delusions,

            hallucinations: hallucinations,
            Insight: Insight,
            Cognitions: Cognitions,

            Provisional_Diagnosis: Provisional_Diagnosis,
            differential_diagnosis: differential_diagnosis,
           occupation: occupation,
           Bir_ae_child: Birthandearlychildhood,
           Name_Of_interviewer: NameOFInterviewert,
            CreatedDate: datetime
        }


        $.ajax({

            type: "POST",
            url: apiurl + 'api/AddInitialAnalysiz',
            data: JSON.stringify(data),
            headers: {
              'Content-Type': 'application/json',
              'Access-Control-Allow-Origin': apiurl,
                    'Authorization': 'Bearer  @Request.Cookies["Token"].Value.ToString()'

                }




        }).done(function (res) {


            if (res.status == 'success') {

                swal({
                    title: "Saved",

                    icon: "success",
                });


                $("#myModal5").modal('hide');

            }
            else {
                alert(res.message);

            }


        })
            .fail(function (XMLHttpRequest, textStatus, errorThrown) {

                if (XMLHttpRequest.status == 403) {
                    window.location.href = '~/Account/Login'
                }

                if (XMLHttpRequest.status == 401) {
                    window.location.href = '/Account/Login'
                }

                console.log("fail");


            })






    })



    $(document).on("click", "#submitbtn", function () {


        var IDD = $("#IDD").val();
        var Present_Complaint = $("#Present_Complaint").val();
        var History_of_Presenting_Complaint = $("#History_of_Presenting_Complaint").val();
        var Past_Psychiatric_History = $("#Past_Psychiatric_History").val();
        var Current_Medication = $("#Current_Medication").val();
        var Physical_History = $("#Physical_History").val();
        var Family_History = $("#Family_History").val();
        var schooling = $("#schooling").val();
        var Maritial_Status = $("#Maritial_Status").val();
        var Adolesence = $("#Adolesence").val();
        var Alcohal = $("#Alcohal").val();
        var Premorbid_personality = $("#Premorbid_personality").val();
        var Mental_State_Examination = $("#Mental_State_Examination").val();
        var Appearance_and_Behavior = $("#Appearance_and_Behavior").val();
        var Speech = $("#Speech").val();
        var Mood_and_Affect = $("#Mood_and_Affect").val();
        var Sucidial_ideations = $("#Sucidial_ideations").val();
        var Thoughts = $("#Thoughts").val();

        var Delusions = $("#Delusions").val();

        var hallucinations = $("#hallucinations").val();

        var Insight = $("#Insight").val();

        var Cognitions = $("#Cognitions").val();

        var Provisional_Diagnosis = $("#Provisional_Diagnosis").val();


        var differential_diagnosis = $("#differential_diagnosis").val();
        var occupation = $("#occupation").val();
        var Birthandearlychildhood = $("#Birthandearlychildhood").val();
        var NameOFInterviewert = $("#NameOFInterviewert").val();
        var DateTime =$("#DateTime").val()


        $.ajax({

            type: "POST",
          url: apiurl+'api/UpdateInitialAnalysiz',
            data: JSON.stringify({
                ID: IDD,

                Pid: patientid,
                Present_Complaint: Present_Complaint,
                History_of_Presenting_Complaint: History_of_Presenting_Complaint,
                Past_Psychiatric_History: Past_Psychiatric_History,
                Current_Medication: Current_Medication,
                Physical_History: Physical_History,
                Family_History: Family_History,
                schooling: schooling,
                Maritial_Status: Maritial_Status,
                Adolesence: Adolesence,
                AlcohalSubstance_abuse: Alcohal,
                Premorbid_personality: Premorbid_personality,
                Mental_State_Examination: Mental_State_Examination,
                Appearance_and_Behavior: Appearance_and_Behavior,

                Speech: Speech,

                Mood_and_Affect: Mood_and_Affect,


                Sucidial_ideations: Sucidial_ideations,

                Thoughts: Thoughts,

                Delusions: Delusions,

                hallucinations: hallucinations,
                Insight: Insight,
                Cognitions: Cognitions,

                Provisional_Diagnosis: Provisional_Diagnosis,
                differential_diagnosis: differential_diagnosis,
                occupation: occupation,
                Bir_ae_child: Birthandearlychildhood,
                Name_Of_interviewer: NameOFInterviewert,
                CreatedDate: DateTime
            }),
            headers: {
              'Content-Type': 'application/json',
              'Access-Control-Allow-Origin': apiurl,
                'Authorization': 'Bearer  @Request.Cookies["Token"].Value.ToString()'

            }




        }).done(function (res) {


            if (res.status == 'success') {


                swal({
                    title: "Saved",

                    icon: "success",
                });


                $("#myModal5").modal('hide');


                //window.location.href = "/Patient/PatientAppointedList";


            }
            else {
                alert(res.message);

            }


        })
            .fail(function (XMLHttpRequest, textStatus, errorThrown) {

                if (XMLHttpRequest.status == 403) {
                    window.location.href = '~/Account/Login'
                }

                if (XMLHttpRequest.status == 401) {
                    window.location.href = '/Account/Login'
                }

                console.log("fail");


            })






    });
    var cityID = "";
    var PCity = "";

    $(".PateintBasicInformation").click(function () {


        $('.loader').show()

            $.ajax({

                type: 'GET',
              url: apiurl+'api/GetPatientByID',
                data: {




                    id: patientid
                },
                headers: {
                  'Content-Type': 'application/json',
                  'Access-Control-Allow-Origin': apiurl,
                    'Authorization': 'Bearer  @Request.Cookies["Token"].Value.ToString()'

                }


            }).done(function (res) {


                var data = JSON.parse(res.object);




                if (res.status == 'success') {

                    $('.loader').hide()

                    $('#Initial_Analysiz2').empty();

                    $('#myModal6').modal('show');


                    var d = data[0].DateOfBirth;

                    if (d != undefined && d != '') {

                        d = d.split('T')[0];
                    }
                    else {
                        d=''
                    }



                    PCity = data[0].c[0].pc[0].CityID;


                    cityID = data[0].c[0].CityID;




                    var editform = `<div class="container">
    <div class="row">
        <div class="col-md-12">
            <form>
                <fieldset>
  <input class="form-control" type="hidden" readonly="" name="username" id="PatientID"   value="`+ data[0].Patient_ID + `"  placeholder="Uasername" required  />


                    <div class="form-group">
                        <label for="username"><span class="req">* </span> Patient  name:  </label>
                        <input class="form-control" type="text" name="username" id="username"   value="`+ data[0].Patient_Name + `"  placeholder="Uasername" required  onkeypress="return ignoreSpaces(event)"/>
                        <div id="errLast"></div>
                    </div>
                    <div class="form-group">
                        <label for="email"><span class="req">* </span> Patient Email Address: </label>
                        <input class="form-control" required type="email" name="email" id="email"  value="`+ data[0].Patient_Email + `"   onchange="email_validate(this.value)" ; />
                        <div class="status" id="status"></div>
                    </div>




                    <div class="form-group">
                        <label for="phonenumber"><span class="req">* </span> Phone Number: </label>
                        <input required type="text" name="phonenumber"    value="`+ data[0].Patient_Phone_Number + `" id="phone" class="form-control phone" maxlength="28" onkeyup="validatephone(this);" placeholder="Phone No:" />
                    </div>


                    <div class="form-group">
                        <label for="Mobilenumber"><span class="req">* </span> Mobile Number: </label>
                        <input required type="text" name="Mobilenumber"  value="`+ data[0].Patient_Mobile_Number + `"   id="Mobile" class="form-control phone" maxlength="28" onkeyup="validatephone(this);" placeholder="Mobile No:" />
                    </div>



                    <div class="form-group">
                        <label for="Address"><span class="req">* </span> Patient  Address:  </label>
                        <br />
                        <textarea rows="4" cols="30" id="Address"  >`+ data[0].Patient_Address + `</textarea>

                    </div>


                    <div class="form-group">
                        <label for="CNIC"><span class="req">* </span> CNIC: </label>
                        <input class="form-control" required type="text" name="CNIC"  value="`+ data[0].CNIC + `" id="CNIC" />

                    </div>




                    <div class="form-group">
                        <label for="DateOFBirth"><span class="req">* </span> Date OF Birth: </label>
                        <input class="form-control" required type="date" name="DateOFBirth"  value="`+ d + `"   id="DateOFBirth" />

                    </div>



                    <div class="form-group">
                        <label for="gender"><span class="req">* </span> Gender: </label>
                        <select class="form-control" id="gender">
                           <option value="`+ data[0].Patient_Gender + `">` + data[0].Patient_Gender +` </option>
                                     `;



                    if (data[0].Patient_Gender == 'Male') {
                        editform += `  <option value="Female">Female </option>
                            <option value="other">Other </option>  ` ;

                    }

                    else if (data[0].Patient_Gender == 'Female') {

                        editform += ` <option value="Male">Male </option>

                            <option value="other">Other </option>`;
                    }
                    else {

                        editform     += ` <option value="Male">Male </option>

                            <option value="other">Other </option>`;
                    }


                    editform += `
                        </select>

                    </div>



                        <input type="hidden" class="" value="`+ data[0].Documents +`" id="ImageUploadnot" name="img">






                    <div class="form-group">
                        <label for="PalceOFBirth"><span class="req">* </span> Palce OF Birth: </label>

                        <select name="PCId" id="PCId"  class="form-control">
           <option value=" `+ data[0].c[0].pc[0].CityID + `"> ` + data[0].c[0].pc[0].City_Name+`</option>
                        </select>

                    </div>




                    <div class="form-group">
                        <label for="City"><span class="req">* </span> Patient  City </label>

                        <select name="CId" id="CId" class="form-control">

 <option value=" `+ data[0].c[0].CityID + `"> ` + data[0].c[0].City_Name +`</option>

</select>

                    </div>





                  <div class="form-group">
                    <label for="Address"><span class="req">* </span> Remarks:  </label>
                    <br />
                    <textarea rows="4" cols="40" id="Comment">`+ data[0].comment+`</textarea>

                  </div>





                    <div class="form-group">

                        <button type="button" class="btn btn-success" id="EditPateint">Update</button>

                    </div>





                </fieldset>
            </form><!-- ends register form -->

        </div><!-- ends col-6 -->


    </div>
</div>


`; $('#Initial_Analysiz2').append(editform);

                    getallcities();

                }
                else {
                    alert(res.message);

                }


            })
            .fail(function (XMLHttpRequest, textStatus, errorThrown) {

                if (XMLHttpRequest.status == 403) {
                    window.location.href = '~/Account/Login'
                }

                if (XMLHttpRequest.status == 401) {
                    window.location.href = '/Account/Login'
                }

                console.log("fail");


            })




    })



    function getallcities() {

            $.ajax({

                type: 'GET',
              url: apiurl+'api/getallcities',

                headers: {
                    'Content-Type': 'application/json',
                  'Access-Control-Allow-Origin': apiurl


                }


            }).done(function (res) {


                var data = JSON.parse(res.object);

                var html = '';
                var place = '';


                $.each(data, function (i, val) {


                    var idd = data[i].CityID

                    if (cityID != idd) {
                        html += `<option value= ` + data[i].CityID + `>` + data[i].City_Name + `</option>`

                    }

                });



                $.each(data, function (i, val) {

                    var Pidd = data[i].CityID;


                    if (PCity != Pidd) {
                        place += `<option value= ` + data[i].CityID + `>` + data[i].City_Name + `</option>`

                    }

                });

                $('#CId').append(html);
                $('#PCId').append(place);


            })
                .fail(function (XMLHttpRequest, textStatus, errorThrown) {
                    console.log("fail");
                })


    }

     function ignoreSpaces(event) {
        var character = event ? event.which : window.event.keyCode;
        if (character == 32) return false;
    }

    var pid = "";
    var username = "";
    var email = "";
    var phone = "";
    var mobile = "";
    var address = "";
    var cinic = "";
    var dataofbirth = "";
    var gender = "";
     var doc             = "";
    var city = "";
    var place_of_Birth = "";
    var Patient_Maritalstatus = "";
  var Comment = "";




    $(document).on("change", "#ImageUpload", function () {
        fasterPreview(this, "Document");


    });





    $(document).on("click", "#EditPateint", function () {


        if ($('#username').val() == '') {
            isAllOkay = false;

            alert('username is  Mandatory!');
            return;
        }


        if ($('#CId').val() == '') {
            isAllOkay = false;
            alert('City  is  Mandatory!');
            return;
        }




        //if ($('#DateOFBirth').val() == '') {
        //    isAllOkay = false;
        //    alert('DateOFBirth is  Mandatory!');x
        //    return;
        //}




        Editpatient();


    })





        function Editpatient() {
        cleardatavariables();

            pid = $("#PatientID").val();
            username = $('#username').val();
           email =      $('#email').val();
            phone =     $('#phone').val();
            mobile =    $('#Mobile').val();
            address =    $('#Address').val();
            cinic =      $('#CNIC').val();;
            dataofbirth =  $('#DateOFBirth').val();
            gender = $('#gender').val();
            city =          $('#CId').val();
            place_of_Birth = $('#PCId').val();
          doc = $("#ImageUploadnot").val();
          Comment = $("#Comment").val();

            $.ajax({

                type: 'POST',
              url: apiurl+'api/PatientUpdate',
                data: JSON.stringify({
                    PatientID: pid,
                    Patient_Name: username,
                    Patient_Email: email,
                    Patient_Phone_Number: phone,
                    Patient_Mobile_Number: mobile,
                    CNIC: cinic,
                    DateOfBirth: dataofbirth,
                    Patient_Gender: gender,
                    Patient_Address: address,
                    Place_Of_Birth: place_of_Birth,
                    //ImageBase64: base64stringform,
                    CityID: city,
                    Documents: doc,
                  Comment: Comment



                }),
                headers: {
                    'Content-Type': 'application/json',
                  'Access-Control-Allow-Origin': apiurl,
                    'Authorization': 'Bearer  @Request.Cookies["Token"].Value.ToString()'

                }


            }).done(function (res) {


                if (res.status == 'success') {

                    base64stringform = [];


                    swal({
                        title: "Saved",

                        icon: "success",
                    });
                    clearformfiledsPrescrition();


                    $("#myModal6").modal('hide');


                    cleardatavariables();
                    ClearFromFileds();
                }
                else {
                    alert(res.message);

                }


            })
                .fail(function (XMLHttpRequest, textStatus, errorThrown) {

                    if (XMLHttpRequest.status==403) {
                        window.location.href = '~/Account/Login'
                    }

                    if (XMLHttpRequest.status == 401) {
                        window.location.href = '/Account/Login'
                    }

                    console.log("fail");


                })







    }



    // validate email
    function email_validate(email) {
        var regMail = /^([_a-zA-Z0-9-]+)(\.[_a-zA-Z0-9-]+)*@@([a-zA-Z0-9-]+\.)+([a-zA-Z]{2,3})$/;

        if (regMail.test(email) == false) {
            document.getElementById("status").innerHTML = "<span class='warning'>Email address is not valid yet.</span>";
        }
        else {
            document.getElementById("status").innerHTML = "<span class='valid'>Thanks, you have entered a valid Email address!</span>";
        }
    }



    function checkPass() {
        //Store the password field objects into variables ...
        var pass1 = document.getElementById('pass1');
        var pass2 = document.getElementById('pass2');
        //Store the Confimation Message Object ...
        var message = document.getElementById('confirmMessage');
        //Set the colors we will be using ...
        var goodColor = "#66cc66";
        var badColor = "#ff6666";
        //Compare the values in the password field
        //and the confirmation field
        if (pass1.value == pass2.value) {
            //The passwords match.
            //Set the color to the good color and inform
            //the user that they have entered the correct password
            pass2.style.backgroundColor = goodColor;
            message.style.color = goodColor;
            message.innerHTML = "Passwords Match"
        } else {
            //The passwords do not match.
            //Set the color to the bad color and
            //notify the user.
            pass2.style.backgroundColor = badColor;
            message.style.color = badColor;
            message.innerHTML = "Passwords Do Not Match!"
        }
    }

    function validatephone(phone) {
        var maintainplus = '';
        var numval = phone.value
        if (numval.charAt(0) == '+') {
            var maintainplus = '';
        }
        curphonevar = numval.replace(/[\\A-Za-z!"£$%^&\,*+_={};:'@@#~,.Š\/<>?|`¬\]\[]/g, '');
        phone.value = maintainplus + curphonevar;
        var maintainplus = '';
        phone.focus;
    }

        function ClearFromFileds() {
            $("#PatientID").val('');
            $('#username').val('');
            $('#email').val('');
            $('#phone').val('');
            $('#Mobile').val('');
            $('#Address').val('');
            $('#CNIC').val('');
             $('#DateOFBirth').val('');
            $('#gender').val('');

            $('#CId').val('');
            $('#PCId').val('');
          $("#ImageUploadnot").val('')
          $("#Comment").val('');
        }

        function cleardatavariables() {

            pid = "";
            username = "";
             email = "";
             phone = "";
             mobile = "";
             address = "";
             cinic = "";
            dataofbirth = "";
             gender = "";
             doc = "";
             city = "";
          place_of_Birth = "";
          Comment = "";

        }

    $(document).on('click', "#cencelappintment", function (){

        var btn = $('.has-spinner');
        $(btn).buttonLoader('start');


                       $.ajax({

                type: 'GET',
              url: apiurl+'api/DeleteAppointment',
                data: {




                    id: appointmentId
                },
                headers: {
                    'Content-Type': 'application/json',
                  'Access-Control-Allow-Origin': apiurl,
                    'Authorization': 'Bearer  @Request.Cookies["Token"].Value.ToString()'

                }


            }).done(function (res) {




              if (res.status == 'success') {

                    alert('cancelled');
                    setTimeout(function () {
                        $(btn).buttonLoader('stop');
                    }, 3000);

                if ('@Request.Cookies["Role"]'==null) {
                  window.location.href = "/Account/Login";
                }
                else if ('@Request.Cookies["Role"].Value.ToString().Contains("Admin")' == 'True' ) {
                  window.location.href = "/Appointment/Index";
                }

                else if ('@Request.Cookies["Role"].Value.ToString().Contains("Assistant")' == 'True') {
                  window.location.href = "/Appointment/Index";
                }
                  else {
                    window.location.href = "/Appointment/DoctorAppointments";
                  }
                }
                else {
                    alert(res.message);

                }


            })
                .fail(function (XMLHttpRequest, textStatus, errorThrown) {

                    if (XMLHttpRequest.status==403) {
                        window.location.href = '~/Account/Login'
                    }

                    if (XMLHttpRequest.status == 401) {
                        window.location.href = '/Account/Login'
                    }

                    console.log("fail");


                })

    })



    function ClearFromFiledsFollowups() {
        $("#PkID").val('');
        $("#PateintID").val('');
        $("#CurrentMedication").jqteVal('');

        $("#ProgressiveNote").jqteVal('');
        $("#Subjective").jqteVal('');
        $("#ObjectiveandMentalStateExamination").jqteVal('');
        $("#Assessment").jqteVal('');
        $("#Plan").jqteVal('');


    }

    //Precription





    function prescriptionTablePage(patientid) {
        $("#prescriptionTable").DataTable({
            "bServerSide": true, //make server side processing to true

            "sAjaxSource": apiurl + "api/Appointment/Predicate?PateintID=" + patientid,
            //url of the Ajax source,i.e. web api method
            "sAjaxDataProp": "aaData", // data property of the returned ajax which contains table data
            "bProcessing": true,
            "bLengthChange": true,
            "sPaginationType": "full_numbers",//pagination type

            "aoColumns": [



                {
                    "mData": "medication", "bSearchable": false, "bSortable": false,
                    "mRender": function (data) {
                        debugger;

                        var htmlEntities4 = data;
                        if (htmlEntities4 != '') {
                            var htmlDecode4 = $.parseHTML(htmlEntities4)[0]['wholeText'];



                            return "<td>" + htmlDecode4 + "</td>"

                        }
                        else {



                            return ""
                        }

                    }
                },





                { "mData": "return_to_Clinic" },




                {
                    //"mData": "presid", "bSearchable": false, "bSortable": false,
                    "mRender": function (x, y, z) {
                        debugger;
                        if (z.patient_Email != null && z.patient_Email !="") {
                            return "<button class='btn btn-success' data-toggle='modal' data-target='#prescriptionModal' onclick='Editprescription(" + JSON.stringify(z.presid) + ")'>Edit</button>  <button class='btn btn-success' data-toggle='modal'  onclick='deleteprescription(" + JSON.stringify(z.presid) + ")'>Delete</button>    <button class='btn btn-success'    onclick='Print(" + JSON.stringify(z.presid) + ")'>Print</button>  <button class='btn btn-success' onclick='sendmail(" + JSON.stringify(z.presid) + ")'>Mail</button> "

                        }
                        else {


                            return "<button class='btn btn-success' data-toggle='modal' data-target='#prescriptionModal' onclick='Editprescription(" + JSON.stringify(z.presid) + ")'>Edit</button>  <button class='btn btn-success' data-toggle='modal'  onclick='deleteprescription(" + JSON.stringify(z.presid) + ")'>Delete</button>    <button class='btn btn-success'    onclick='Print(" + JSON.stringify(z.presid) + ")'>Print</button> "

                        }

                    }
                }




            ]
        });

    }


    function clearformfiledsPrescrition() {
        $("#Presid").val('')
        $("#PateintIDPrec").val('')

        $("#Prescription").jqteVal('');

        Medication: $("#Medication").jqteVal(''),
           $("#Investigations").jqteVal(''),
        $("#Referral").jqteVal(''),
           $("#Advice").jqteVal(''),
                  $("#Return_to_Clinic").val('')
    }

    $("#prescriptionModalbutton").click(function () {
        $("#Return_to_Clinic").datepicker({
            dateFormat: 'yyyy-mm-dd',
            changeMonth: true,
            changeYear: true
        });
        clearformfiledsPrescrition();

    })


    var pateintArray=[];


    function serachpateint() {
        $.ajax({

            type: 'GET',

            url: apiurl + 'api/getallPatient',

            headers: {
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': apiurl


            }


        }).done(function (res) {


            var data = JSON.parse(res.object);

            $.each(data, function (i, value) {

                pateintArray.push({ id: data[i].Patient_ID, text: data[i].Patient_Name });

            });






        })
            .fail(function (XMLHttpRequest, textStatus, errorThrown) {
                console.log("fail");
            })

    }



    var suggesid = "";

    function suggest(id) {

        $("#prescriptinSuggestmodal").modal('show');

        $("#SuggestPatient").select2({
            placeholder: "Select a Patient",
            data: pateintArray
        });

        suggesid = id;


    }

    $("#SuggestprescriptionSavebtn").click(function () {

        if ($("#SuggestPatient").val() == "") {

            swal({
                title: "Patient Name is Required",

                icon: "warning",
            });

            return;

        }




        if ($("#SuggestFromDate").val() == "") {

            swal({
                title: "From Date is Required",

                icon: "warning",
            });

            return;

        }


        if ($("#SuggestToDate").val() == "") {

            swal({
                title: "To Date is Required",

                icon: "warning",
            });

            return;

        }

        suggesttopateint(suggesid);
    });


    function suggesttopateint(id) {

             $.ajax({

                type: 'POST',
                 url: apiurl +'api/Appointment/SuggestPrescription',
                 data: JSON.stringify({

                     Presid: id,
                     Pid: $("#SuggestPatient").val(),

                     FromDate: $("#SuggestFromDate").val(),
                     ToDate: $("#SuggestToDate").val()

                }),
                headers: {
                    'Content-Type': 'application/json',
                  'Access-Control-Allow-Origin': apiurl,
                    'Authorization': 'Bearer  @Request.Cookies["Token"].Value.ToString()'

                }


            }).done(function (res) {


                if (res.status == 'success') {
                    swal({
                        title: "Saved",

                        icon: "success",
                    });

                    $("#prescriptinSuggestmodal").modal('hide');

                }
                else {
                    alert(res.message);

                }


            })
                .fail(function (XMLHttpRequest, textStatus, errorThrown) {

                    if (XMLHttpRequest.status==403) {
                        window.location.href = '~/Account/Login'
                    }

                    if (XMLHttpRequest.status == 401) {
                        window.location.href = '/Account/Login'
                    }

                    console.log("fail");


                })






    }


    $("#prescriptionSavebtn").click(function () {

        var Presid= $("#Presid").val();


        if (Presid > 0) {
             $.ajax({

                type: 'POST',
                 url: apiurl +'api/Appointment/EditPrescription',
                 data: JSON.stringify({

                     Presid:Presid,
                    Pid: patientid,
                     Medication: $("#Medication").val(),
                     Investigations: $("#Investigations").val(),
                     Referral: $("#Referral").val(),
                     Advice: $("#Advice").val(),
                     Return_to_Clinic: $("#Return_to_Clinic").val(),
                     AppointmentID: appointmentId == '' ? parseInt(patientid): appointmentId


                }),
                headers: {
                    'Content-Type': 'application/json',
                  'Access-Control-Allow-Origin': apiurl,
                    'Authorization': 'Bearer  @Request.Cookies["Token"].Value.ToString()'

                }


            }).done(function (res) {


                if (res.status == 'success') {
                    $("#prescriptionTable").DataTable().ajax.reload();
                    swal({
                        title: "Saved",

                        icon: "success",
                    });
                    clearformfiledsPrescrition();

                    $("#prescriptionModal").modal('hide');

                }
                else {
                    alert(res.message);

                }


            })
                .fail(function (XMLHttpRequest, textStatus, errorThrown) {

                    if (XMLHttpRequest.status==403) {
                        window.location.href = '~/Account/Login'
                    }

                    if (XMLHttpRequest.status == 401) {
                        window.location.href = '/Account/Login'
                    }

                    console.log("fail");


                })

        }
        else {


            $.ajax({

                type: 'POST',
                url: apiurl +'api/Appointment/ADDprescription',
                data: JSON.stringify({
                    Pid: patientid,
                    Medication: $("#Medication").val(),
                    Investigations: $("#Investigations").val(),
                    Referral: $("#Referral").val(),
                    Advice: $("#Advice").val(),
                    Return_to_Clinic: $("#Return_to_Clinic").val(),
                    AppointmentID: appointmentId == '' ? parseInt(patientid) : appointmentId

                }),
                headers: {
                    'Content-Type': 'application/json',
                  'Access-Control-Allow-Origin': apiurl,
                    'Authorization': 'Bearer  @Request.Cookies["Token"].Value.ToString()'

                }


            }).done(function (res) {


                if (res.status == 'success') {
                    $("#prescriptionTable").DataTable().ajax.reload();

                    swal({
                        title: "Saved",

                        icon: "success",
                    });

                    clearformfiledsPrescrition();

                    $("#prescriptionModal").modal('hide');

                }
                else {
                    alert(res.message);

                }


            })
                .fail(function (XMLHttpRequest, textStatus, errorThrown) {

                    if (XMLHttpRequest.status==403) {
                        window.location.href = '~/Account/Login'
                    }

                    if (XMLHttpRequest.status == 401) {
                        window.location.href = '/Account/Login'
                    }

                    console.log("fail");


                })

        }



    });


    function Editprescription(id) {



             $.ajax({

                 type: 'Get',
                 url: apiurl + 'api/Appointment/GetPrescriptionbyid?id=' + id,
                headers: {
                    'Content-Type': 'application/json',
                  'Access-Control-Allow-Origin': apiurl,
                    'Authorization': 'Bearer  @Request.Cookies["Token"].Value.ToString()'

                }


            }).done(function (res) {


                if (res.status == 'success') {

                    $("#prescriptionModal").modal('show');


                   var data= JSON.parse(res.object);
                    $("#Presid").val(data[0].Presid);
                    $("#PateintIDPrec").val(data[0].Pid)


                    var htmlEntities3 = data[0].Medication;

                    if (htmlEntities3 != '') {
                        var htmlDecode3 = $.parseHTML(htmlEntities3)[0]['wholeText'];


                        $("#Medication").jqteVal(htmlDecode3);

                    }
                    var htmlEntities4 = data[0].Investigations;

                    if (htmlEntities4 != '') {
                        var htmlDecode3 = $.parseHTML(htmlEntities4)[0]['wholeText'];


                        $("#Investigations").jqteVal(htmlDecode3);

                    }
                    var htmlEntities5 = data[0].Referral;
                    if (htmlEntities5 != '') {
                        var htmlDecode3 = $.parseHTML(htmlEntities5)[0]['wholeText'];


                        $("#Referral").jqteVal(htmlDecode3);

                    }
                    var htmlEntities6 = data[0].Advice;
                    if (htmlEntities6 != '') {
                        var htmlDecode3 = $.parseHTML(htmlEntities6)[0]['wholeText'];


                        $("#Advice").jqteVal(htmlDecode3);

                    }




                    $("#Return_to_Clinic").val(data[0].Return_to_Clinic)


                }
                else {
                    alert(res.message);

                }


            })
                .fail(function (XMLHttpRequest, textStatus, errorThrown) {

                    if (XMLHttpRequest.status==403) {
                        window.location.href = '~/Account/Login'
                    }

                    if (XMLHttpRequest.status == 401) {
                        window.location.href = '/Account/Login'
                    }

                    console.log("fail");


                })

    }






    function Print(id) {

             $.ajax({

                 type: 'GET',
                 url: apiurl + 'api/Appointment/print?id=' + id,
                headers: {
                    'Content-Type': 'application/json',
                  'Access-Control-Allow-Origin': apiurl,
                    'Authorization': 'Bearer  @Request.Cookies["Token"].Value.ToString()'

                }


            }).done(function (res) {

                var nowDate = new Date();
                var nowDay = ((nowDate.getDate().toString().length) == 1) ? '0' + (nowDate.getDate()) : (nowDate.getDate());
                var nowMonth = ((nowDate.getMonth().toString().length) == 1) ? '0' + (nowDate.getMonth() + 1) : (nowDate.getMonth() + 1);
                var nowYear = nowDate.getFullYear();
                var formatDate = nowYear + "-" + nowMonth + "-" + nowDay;

                if (res.status == 'success') {



                    var data = JSON.parse(res.object);


                    var doc = new jsPDF();
                    debugger;
                    var pateintName = data[0].p[0].Patient_Name;
                    var Medication = data[0].Medication;
                    var Advice = data[0].Advice;
                    var Investigations = data[0].Investigations;
                    var Return_to_Clinic = data[0].Return_to_Clinic
                    var MR_No = data[0].p[0].MR_No;
                    var pateintName = data[0].p[0].Patient_Name;
                    var pateintdateofbirth = data[0].p[0].DateOfBirth;
                    var referrel = data[0].Referral;
                    var doctorname = data[0].p[0].u[0].doctorname;
                    var Medicationhtml;
                    var Medicationr;

                    if (Medication != "") {
                         Medicationhtml = $.parseHTML(Medication)[0]['wholeText'];
                         Medicationr = (stripHtml(Medicationhtml));


                        doc.setFontSize(12);
                        doc.text(20, 75, 'Medication : ');


                        var strArr = doc.splitTextToSize(Medicationr, 150)
                        doc.text(50, 75, strArr);


                    }
                    else {

                        Medicationhtml = '';
                        Medicationr = '';

                    }


                    var Advicetml;

                    var Advicetmlr;


                    if (Advice != "") {
                         Advicetml = $.parseHTML(Advice)[0]['wholeText'];
                         Advicetmlr = (stripHtml(Advicetml));

                    }
                    else {

                         Advicetml=""

                         Advicetmlr=""

                    }

                    var Investigationstml;
                    var Investigationstmlr;


                    if (Investigations != "") {
                        Investigationstml = $.parseHTML(Investigations)[0]['wholeText'];
                        Investigationstmlr = (stripHtml(Investigationstml));
                        var dim = doc.getTextDimensions('Text');
                        console.log(dim);


                        var Investigationstmlrv = doc.splitTextToSize(Investigationstmlr, 150)

                        doc.setFontSize(12);
                        doc.text(20, 75 + (dim.h * 4), 'Investigations : ');
                        doc.text(50, 75 + (dim.h * 4), Investigationstmlrv);


                    }
                    else {
                       Investigationstml="";
                        Investigationstmlr="";

                    }


                    var referrelhtml;
                    var referrelhtmlr;
                    if (referrel != "") {
                        referrelhtml  =$.parseHTML(referrel)[0]['wholeText'];
                        referrelhtmlr = (stripHtml(referrelhtml));

                        var dim = doc.getTextDimensions('Text');
                        console.log(dim);



                        var referrelhtmlrv = doc.splitTextToSize(referrelhtmlr, 150)


                        doc.setFontSize(12);
                        doc.text(20, 75 + (dim.h * 7), 'Referrel : ');
                        doc.text(50, 75 + (dim.h * 7), referrelhtmlrv);

                    }
                    else {

                         referrelhtml="";
                         referrelhtmlr="";
                    }




                    var specialElementHandlers = {
                        '#editor': function (element, renderer) {
                            return true;
                        }
                    };    var img = new Image();
                    img.src = "/Content/Synapse-Logo.png";


                    doc.setDrawColor(255, 0, 0);
                    doc.line(10, 30, 200, 30);
                    doc.setFontSize(12);
                    doc.text(20, 38, 'Name : ');
                    doc.setFontSize(12);
                    doc.text(42, 38, pateintName);


                    doc.setFontSize(12);
                    doc.text(20, 48, 'Age : ');
                    doc.setFontSize(12);
                    doc.text(42, 48, JSON.stringify(pateintdateofbirth));


                    doc.setFontSize(12);
                    doc.text(100, 38, 'Medical Record (MR) Number : ');


                    doc.setFontSize(12);
                    doc.text(160, 38, MR_No);


                    doc.setFontSize(12);



                    doc.text(100, 48, 'Date   : ');


                    doc.setFontSize(12);



                    doc.text(120, 48, formatDate);





                    doc.setDrawColor(255, 0, 0);
                    doc.line(10, 52, 200, 52);

                    doc.setFontSize(16);
                    doc.text(90, 60, 'Treatment Plan');

                    doc.setDrawColor(255, 0, 0);
                    doc.line(130, 64, 90, 64);








                    var dim = doc.getTextDimensions('Text');
                    console.log(dim);




                    doc.setFontSize(12);
                    doc.text(18, 75 + (dim.h * 10), 'Return to Clinic :  ');
                    doc.text(50, 75 + (dim.h * 10), Return_to_Clinic);




                    doc.setFontSize(12);
                    doc.text(15, 280, 'Doctor Name  : ');
                    doc.text(45, 280 , doctorname);



                    doc.setFontSize(12);
                    doc.text(110, 280, 'Doctor Signature :'  );
                    doc.text(150, 280, '__________________');


                    //doc.setFontSize(18);
                    //doc.text(60, 75 + (dim.h * 13), 'REIMAGING CONNECTIONS');

                    doc.setDrawColor(255, 0, 0);
                    doc.line(10, 290, 200,290 );



                    doc.setFontSize(10);
                    doc.text(2,295,'4th floor GPC,13 Rojhan Street,Block 5 Clifton ,karachi,75600,Pakistan | Phone : +92 3041118000 | Email : Contact@synapse.org.pk  ');


                    img.onload = function () {
                        doc.addImage(img, 'PNG', 70, 2, 80, 30);
                       // doc.save(MR_No + "_" + formatDate + '.pdf');
                        doc.autoPrint();
                        window.open(doc.output('bloburl'), '_blank');
                    };



                }
                else {
                    alert(res.message);

                }


            })
                .fail(function (XMLHttpRequest, textStatus, errorThrown) {

                    if (XMLHttpRequest.status==403) {
                        window.location.href = '~/Account/Login'
                    }

                    if (XMLHttpRequest.status == 401) {
                        window.location.href = '/Account/Login'
                    }

                    console.log("fail");


                })

    }


    function deleteprescription(id) {

             $.ajax({

                 type: 'GET',
                 url: apiurl + 'api/Appointment/DeletePrescription?id=' + id,
                headers: {
                    'Content-Type': 'application/json',
                  'Access-Control-Allow-Origin': apiurl,
                    'Authorization': 'Bearer  @Request.Cookies["Token"].Value.ToString()'

                }


            }).done(function (res) {


                if (res.status == 'success') {
                    swal({
                        title: "Deleted",

                        icon: "success",
                    });

                    $("#prescriptionTable").DataTable().ajax.reload();
                }
                else {
                    alert(res.message);

                }


            })
                .fail(function (XMLHttpRequest, textStatus, errorThrown) {

                    if (XMLHttpRequest.status==403) {
                        window.location.href = '~/Account/Login'
                    }

                    if (XMLHttpRequest.status == 401) {
                        window.location.href = '/Account/Login'
                    }

                    console.log("fail");


                })


    }

    function stripHtml(html) {
        // Create a new div element
        var temporalDivElement = document.createElement("div");
        // Set the HTML content with the providen
        temporalDivElement.innerHTML = html;
        // Retrieve the text property of the element (cross-browser support)
        return temporalDivElement.textContent || temporalDivElement.innerText || "";
    }



    function sendmail(id) {


        $.ajax({

                 type: 'GET',
            url: apiurl + 'api/Appointment/sendprescriptionbyemial?priId=' + id,
                headers: {
                    'Content-Type': 'application/json',
                  'Access-Control-Allow-Origin': apiurl,
                    'Authorization': 'Bearer  @Request.Cookies["Token"].Value.ToString()'

                }


            }).done(function (res) {


                if (res.status == 'success') {
                    swal({
                        title: "Deleted",

                        icon: "success",
                    });

                    $("#prescriptionTable").DataTable().ajax.reload();
                }
                else {
                    alert(res.message);

                }


            })
                .fail(function (XMLHttpRequest, textStatus, errorThrown) {

                    if (XMLHttpRequest.status==403) {
                        window.location.href = '~/Account/Login'
                    }

                    if (XMLHttpRequest.status == 401) {
                        window.location.href = '/Account/Login'
                    }

                    console.log("fail");


                })


    }


    function ShowLoader() {
     }
</script>
