
@{
    ViewBag.Title = "CityList";
}

<div class="container-fluid">
    <!-- ============================================================== -->
    <!-- Start Page Content -->
    <!-- ============================================================== -->
    <div class="row">
        <!-- Column -->
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table id="producttable" class="table table-bordered table-hover">
                            <thead>
                                <tr>

                                    <th>City Name</th>
                                    <th>Actions</th>

                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <!-- Column -->
    </div>
    <!-- ============================================================== -->
    <!-- End PAge Content -->
    <!-- ============================================================== -->
    <!-- ============================================================== -->
    <!-- Right sidebar -->
    <!-- ============================================================== -->
    <!-- .right-sidebar -->
    <!-- ============================================================== -->
    <!-- End Right sidebar -->
    <!-- ============================================================== -->
</div>


<script>

  var apiurl = "@System.Configuration.ConfigurationManager.AppSettings["url"]";

  $(document).ready(function () {
            $("#producttable").DataTable({
                "bServerSide": true, //make server side processing to true
              "sAjaxSource": apiurl+"api/GetserverCity", //url of the Ajax source,i.e. web api method
                "sAjaxDataProp": "aaData", // data property of the returned ajax which contains table data
                "bProcessing": true,
                "bLengthChange": true,
                "sPaginationType": "full_numbers",//pagination type

                "aoColumns": [

                    { "mData": "name" },






                {
                    "mData": "id", "bSearchable": false, "bSortable": false,

                    "mRender": function (data) {


                        var id = data;

                        return "<button type = 'button'   onclick='Editp(" + JSON.stringify(id) +  ")' class='ml-2 btn btn-info btn-circle'><i class='fa fa-edit'></i></button>"

                    }
                }



                ]
            });

        });



    function Editp(ID) {


            $.ajax({

                type: 'GET',
              url: apiurl+'api/GetCitiesbyid',
                data: {
                    id: ID
                },
                headers: {
                    'Content-Type': 'application/json',
                  'Access-Control-Allow-Origin': apiurl,
                    'Authorization': 'Bearer  @Request.Cookies["Token"].Value.ToString()'

                }


            }).done(function (res) {



                var data = JSON.parse(res.object);


                console.log(data);



                if (res.status == 'success') {





                    var editform = `<div class="container">
    <div class="row">
        <div class="col-md-6">
            <form>
                <fieldset>
  <input class="form-control" type="hidden" name="username" id="CityID"   value="`+ data[0].CityID + `"  placeholder="Uasername" required />


                    <div class="form-group">
                        <label for="username"><span class="req">* </span> City  name:  </label>
                        <input class="form-control" type="text" name="username" id="CityName"   value="`+ data[0].City_Name + `"  placeholder="Uasername" required />
                        <div id="errLast"></div>
                    </div>




                    <div class="form-group">

                        <button type="button" class="btn btn-success" id="Registerc">Update</button>
                        <button class=" btn-secondary" type="button" onclick="editcencelc()">Cancel</button>
                    </div>





                </fieldset>
            </form><!-- ends register form -->

        </div><!-- ends col-6 -->


    </div>
</div>


`;




                    $('#actioncontainer').html("");


                    $('#actioncontainer').append(editform);

                    focusaction('actioncontainer');

                }
                else {
                    alert(res.message);

                }


            })
                .fail(function (XMLHttpRequest, textStatus, errorThrown) {
                    debugger;

                    if (XMLHttpRequest.status==403) {
                        window.location.href = '~/Account/Login'
                    }

                    if (XMLHttpRequest.status == 401) {
                        window.location.href = '/Account/Login'
                    }

                    console.log("fail");


                })




    }




    function editcencelc() {


        $('#actioncontainer').html("");


    }


    var Cid = "";
    var CityName = "";




    $(document).on("click", "#Registerc", function () {


        if ($('#CityName').val() == '') {
            isAllOkay = false;

            alert('CityName is  Mandatory!');
            return;
        }

        EditCity();


    })





    function EditCity() {
        cleardatavariables();

        Cid = $("#CityID").val();
        CityName= $('#CityName').val()




            $.ajax({

                type: 'POST',
              url: apiurl+'api/Createcities',
                data: JSON.stringify({
                    ID: Cid,
                    Name: CityName,
                }),
                headers: {
                    'Content-Type': 'application/json',
                  'Access-Control-Allow-Origin': apiurl,
                    'Authorization': 'Bearer  @Request.Cookies["Token"].Value.ToString()'

                }


            }).done(function (res) {

                console.log(res);

                if (res.status == 'success') {

                    alert('updated');
                    base64stringform = "";
                    //ClearFromFileds();
                    //$("#actioncontainer").html("");

                    window.location.reload();

                }
                else {
                    alert(res.message);

                }


            })
                .fail(function (XMLHttpRequest, textStatus, errorThrown) {
                    debugger;

                    if (XMLHttpRequest.status==403) {
                        window.location.href = '~/Account/Login'
                    }

                    if (XMLHttpRequest.status == 401) {
                        window.location.href = '/Account/Login'
                    }

                    console.log("fail");


                })







    }





        function ClearFromFileds() {
            $("#CityID").val('');
            $('#CityName').val('');
        }

        function cleardatavariables() {

            Cid = "";
            CityName = "";

        }


    function Deletep(ID) {




            $.ajax({

                type: 'GET',
              url: apiurl+'api/DeleteCity',
                data: {




                    id: ID
                },
                headers: {
                    'Content-Type': 'application/json',
                  'Access-Control-Allow-Origin': apiurl,
                    'Authorization': 'Bearer  @Request.Cookies["Token"].Value.ToString()'

                }


            }).done(function (res) {

                console.log(res);

                if (res.status == 'success') {

                    alert('deleted');


                    window.location.reload();

                }
                else {
                    alert(res.message);

                }


            })
                .fail(function (XMLHttpRequest, textStatus, errorThrown) {
                    debugger;

                    if (XMLHttpRequest.status==403) {
                        window.location.href = '~/Account/Login'
                    }

                    if (XMLHttpRequest.status == 401) {
                        window.location.href = '/Account/Login'
                    }

                    console.log("fail");


                })





        }


    function focusaction(focusdivid) {
        $('html, body').animate({
            scrollTop: $("#" + focusdivid).offset().top + 70
        }, 1000);
    }


  $("#pushmenudash").click(function () {

    var id = $(this).attr('data-id');


    var a = $('#bodytocheckclass').hasClass('sidebar-collapse');

    if (a == true) {

      $('#bodytocheckclass').removeClass('sidebar-mini layout-fixed  sidebar-collapse');
      $('#bodytocheckclass').addClass('sidebar-mini layout-fixed  ')
    }

    else {

      $('#bodytocheckclass').removeClass('sidebar-mini layout-fixed  ');
      $('#bodytocheckclass').addClass('sidebar-mini layout-fixed  sidebar-collapse ')
    }

  });


</script>
